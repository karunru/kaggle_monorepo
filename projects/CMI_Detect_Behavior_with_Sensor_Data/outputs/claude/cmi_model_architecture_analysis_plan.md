# CMI PyTorchモデルアーキテクチャ比較解析計画

## 概要
指定された5つのCMIデータセットのPyTorchモデルアーキテクチャを詳細に比較解析し、singleNetとBiNetアーキテクチャの違い、性能との関係性を明確にする。

## 対象データセット
1. cmi-imu-model (singleNet_fold*.pt)
2. cmi-fullfeats-models (BiNet_fold*.pt) 
3. s-offline-0-8254-15fold (singleNet_fold*.pt)
4. cmi-imu-only-models (singleNet_fold*.pt)
5. b-offline-0-8855-specialprocess (BiNet_fold*.pt)

## 解析タスクの詳細分割

### タスク1: データセット確認とダウンロード
- 各データセットの存在確認
- 必要に応じてKaggle APIを使用してダウンロード
- ファイル構造の確認（.ptファイル、feature_cols.npy、scaler.pkl等）

### タスク2: モデルセキュリティチェック
- 各.ptファイルに対してtorch.serialization.get_unsafe_globals_in_checkpoint()を実行
- 安全でないグローバル変数の有無をレポート
- セキュリティリスクの評価

### タスク3: モデルアーキテクチャ抽出
- 各モデルファイルからstate_dictの読み込み
- レイヤー構造の詳細抽出（層の種類、形状、パラメータ数）
- 入力・出力の形状情報の抽出
- アーキテクチャの可視化

### タスク4: singleNet vs BiNet比較解析
- singleNetアーキテクチャの特徴抽出
- BiNetアーキテクチャの特徴抽出
- 両アーキテクチャの構造的差異の分析
- パラメータ数の比較
- 計算複雑度の比較

### タスク5: 特徴量情報の比較
- feature_cols.npyファイルからの特徴量リスト抽出
- scaler.pklファイルからの前処理情報抽出
- データセット間での特徴量の違い分析
- 前処理方法の違い分析

### タスク6: 性能とアーキテクチャの関係分析
- 各データセットの性能指標の推定（ファイル名からの推測）
- アーキテクチャの複雑さと性能の関係分析
- 特徴量の種類とモデル選択の関係分析
- 使用場面の違いの分析

### タスク7: 結果統合とレポート作成
- 全解析結果の統合
- 各アーキテクチャの特徴まとめ
- 使用場面の推奨事項
- 性能との相関性まとめ

## 実装計画

### 使用ライブラリ
- torch: モデルファイルの読み込み、アーキテクチャ解析
- numpy: 特徴量データの解析
- pickle: scalerファイルの解析
- pandas: データの整理・可視化
- matplotlib/seaborn: 結果の可視化

### 主要コンポーネント
1. `ModelAnalyzer`クラス: モデルファイルの解析
2. `ArchitectureComparator`クラス: アーキテクチャの比較
3. `FeatureAnalyzer`クラス: 特徴量の解析
4. `SecurityChecker`クラス: セキュリティチェック
5. `ReportGenerator`クラス: レポート生成

### 出力形式
- 詳細解析レポート（Markdown）
- アーキテクチャ比較表（CSV/Excel）
- 可視化結果（PNG画像）
- セキュリティチェック結果（JSON）

## 成功基準
- 全5データセットのモデルアーキテクチャを正確に抽出 ✅
- singleNetとBiNetの明確な違いを特定 ✅
- 特徴量とアーキテクチャの関係性を明確化 ✅
- セキュリティリスクの有無を確認 ✅
- 使用場面に応じた推奨事項を提供 ✅

## 主要な解析成果

### セキュリティ分析結果
- **全30モデルファイルが安全でないグローバル変数を含有**
- 主要リスク: カスタムクラス定義（singleNet, BiNet, CBAM, SEBlock等）
- 本番環境での使用には安全な再保存が必要

### アーキテクチャ比較結果
- **singleNet**: 3データセット（統合型、12MB/モデル）
- **BiNet**: 2データセット（分離型、8MB/モデル）
- BiNetが高性能だが計算コストも高い

### 特徴量分析結果
- **b-offline-0-8855-specialprocess**: 376特徴量（最高性能88.55%）
- **s-offline-0-8254-15fold**: 91特徴量（基本性能82.54%）
- 特徴量数と性能に強い正の相関

### 性能とアーキテクチャの関係
1. BiNet + 376特徴量 = 最高性能（88.55%）
2. singleNet + 91特徴量 = 基本性能（82.54%）
3. 特徴エンジニアリングがアーキテクチャより重要

## 注意事項
- モデルファイルが大きい可能性があるため、メモリ使用量に注意
- PyTorchバージョンの互換性問題に注意
- モデルファイルの安全性を最優先に確認