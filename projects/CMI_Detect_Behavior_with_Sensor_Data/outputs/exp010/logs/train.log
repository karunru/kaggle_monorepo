08/08/2025 12:26:40 AM INFO __main__: Starting cross-validation training
08/08/2025 12:26:40 AM INFO __main__: Configuration: {'experiment': {'exp_num': 'exp010', 'name': 'exp010_early_stopping_with_loss', 'description': 'Early stopping with val_loss instead of val_cmi_score', 'tags': ['imu_only', 'squeezeformer', 'pytorch_lightning', 'early_stopping_loss']}, 'paths': {'output_dir': '../../../outputs/exp010'}, 'data': {'root': '../../../data', 'train_path': '../../../data/train.csv', 'test_path': '../../../data/test.csv', 'tof_mode': 16, 'percentile': 0.95}, 'model': {'name': 'cmi_bert_model', 'imu_dim': 20, 'thm_dim': 5, 'tof_dim': 340, 'feat_dim': 500, 'num_classes': 18, 'imu1_channels': 219, 'imu1_layers': 0, 'imu2_layers': 0, 'imu1_dropout': 0.295, 'imu2_dropout': 0.27, 'thm1_channels': 82, 'thm1_dropout': 0.264, 'thm2_dropout': 0.303, 'tof1_channels': 82, 'tof1_dropout': 0.264, 'tof2_dropout': 0.303, 'bert_layers': 8, 'bert_heads': 10, 'cls1_channels': 937, 'cls2_channels': 303, 'cls1_dropout': 0.228, 'cls2_dropout': 0.225}, 'training': {'seed': 42, 'batch_size': 128, 'num_workers': 4, 'epochs': 100, 'learning_rate': 0.0003, 'weight_decay': 1e-05, 'gradient_clip_val': 1.0, 'scheduler_type': 'cosine', 'scheduler_min_lr': 1e-06, 'scheduler_factor': 0.5, 'scheduler_patience': 5, 'early_stopping_patience': 15, 'use_mixed_precision': True, 'accumulate_grad_batches': 1}, 'loss': {'type': 'cmi', 'alpha': 0.5, 'focal_gamma': 2.0, 'focal_alpha': 1.0}, 'length_grouping': {'enabled': False, 'use_dynamic_padding': False, 'mega_batch_multiplier': 8, 'percentile_max_length': 0.95, 'min_sequence_length': 50, 'max_sequence_length': 500, 'put_longest_first': True, 'fallback_to_fixed_length': True}, 'schedule_free': {'enabled': False, 'optimizer_type': 'RAdamScheduleFree', 'learning_rate_multiplier': 5.0, 'warmup_steps': 1000, 'batch_norm_calibration_steps': 50}, 'ema': {'enabled': True, 'beta': 0.9999, 'update_after_step': 1000, 'update_every': 10, 'update_model_with_ema_every': 1000, 'use_ema_for_validation': True}, 'val': {'name': 'stratified_group_kfold', 'params': {'n_splits': 5, 'random_state': 42, 'target': 'gesture', 'group': 'subject', 'id': 'sequence_id', 'force_recreate': False}}, 'preprocessing': {'target_sequence_length': 200}, 'augmentation': {'gaussian_noise_prob': 0.3, 'gaussian_noise_std': 0.01, 'time_scaling_prob': 0.3, 'time_scaling_range': [0.9, 1.1], 'partial_masking_prob': 0.2, 'partial_masking_length_range': [5, 20], 'partial_masking_ratio': 0.1}, 'logging': {'wandb_enabled': True, 'wandb_project': 'CMI-Detect-Behavior-with-Sensor-Data', 'wandb_name': 'exp010', 'wandb_tags': ['exp010', 'switch_ema', 'squeezeformer']}, 'lightning': {'trainer': {'accelerator': 'auto', 'devices': 'auto', 'precision': '16-mixed', 'deterministic': False, 'benchmark': True, 'enable_checkpointing': True, 'log_every_n_steps': 10, 'check_val_every_n_epoch': 1, 'val_check_interval': 1.0}, 'callbacks': {'model_checkpoint': {'monitor': 'val_cmi_score', 'mode': 'max', 'save_top_k': 1, 'save_last': True, 'filename': 'epoch-{epoch:02d}-val_cmi_score-{val_cmi_score:.4f}', 'auto_insert_metric_name': False}, 'early_stopping': {'monitor': 'val_cmi_score', 'mode': 'max', 'patience': 15, 'min_delta': 0.001, 'verbose': True}, 'lr_monitor': {'logging_interval': 'epoch'}, 'rich_progress_bar': {'enable': False}}}, 'root': '../../../outputs/exp010', 'target_gestures': ['Above ear - pull hair', 'Forehead - pull hairline', 'Forehead - scratch', 'Eyebrow - pull hair', 'Eyelash - pull hair', 'Neck - pinch skin', 'Neck - scratch', 'Cheek - pinch skin'], 'non_target_gestures': ['Drink from bottle/cup', 'Glasses on/off', 'Pull air toward your face', 'Pinch knee/leg skin', 'Scratch knee/leg skin', 'Write name on leg', 'Text on phone', 'Feel around in tray and pull out an object', 'Write name in air', 'Wave hello'], 'imu_features': ['acc_x', 'acc_y', 'acc_z', 'rot_w', 'rot_x', 'rot_y', 'rot_z']}
08/08/2025 12:26:40 AM INFO __main__: Starting training for fold 0
08/08/2025 12:26:45 AM ERROR __main__: Error in fold 0
Traceback (most recent call last):
  File "/home/karunru/Home/Kaggle/kaggle_monorepo/projects/CMI_Detect_Behavior_with_Sensor_Data/.venv/lib/python3.13/site-packages/pandas/core/indexes/base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 0

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/karunru/Home/Kaggle/kaggle_monorepo/projects/CMI_Detect_Behavior_with_Sensor_Data/codes/exp/exp010/train.py", line 258, in train_cross_validation
    fold_result = train_single_fold(config, fold, logger, wandb_logger)
  File "/home/karunru/Home/Kaggle/kaggle_monorepo/projects/CMI_Detect_Behavior_with_Sensor_Data/codes/exp/exp010/train.py", line 129, in train_single_fold
    data_module.setup("fit")
    ~~~~~~~~~~~~~~~~~^^^^^^^
  File "/home/karunru/Home/Kaggle/kaggle_monorepo/projects/CMI_Detect_Behavior_with_Sensor_Data/codes/src/utils/timer.py", line 39, in wrapper
    result = func(*args, **kwargs)
  File "/home/karunru/Home/Kaggle/kaggle_monorepo/projects/CMI_Detect_Behavior_with_Sensor_Data/codes/exp/exp010/dataset.py", line 818, in setup
    self.train_dataset = IMUDataset(
                         ~~~~~~~~~~^
        train_sequence_ids,
        ^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
        percentile=self.percentile,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/home/karunru/Home/Kaggle/kaggle_monorepo/projects/CMI_Detect_Behavior_with_Sensor_Data/codes/exp/exp010/dataset.py", line 346, in __init__
    self._preprocess_data()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "/home/karunru/Home/Kaggle/kaggle_monorepo/projects/CMI_Detect_Behavior_with_Sensor_Data/codes/src/utils/timer.py", line 39, in wrapper
    result = func(*args, **kwargs)
  File "/home/karunru/Home/Kaggle/kaggle_monorepo/projects/CMI_Detect_Behavior_with_Sensor_Data/codes/exp/exp010/dataset.py", line 481, in _preprocess_data
    self.df = self._apply_feature_engineering(self.df)
              ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^
  File "/home/karunru/Home/Kaggle/kaggle_monorepo/projects/CMI_Detect_Behavior_with_Sensor_Data/codes/exp/exp010/dataset.py", line 510, in _apply_feature_engineering
    linear_accel = remove_gravity_from_acc(acc_data, rot_data)
  File "/home/karunru/Home/Kaggle/kaggle_monorepo/projects/CMI_Detect_Behavior_with_Sensor_Data/codes/exp/exp010/dataset.py", line 44, in remove_gravity_from_acc
    if np.all(np.isnan(quat_values[i])) or np.all(np.isclose(quat_values[i], 0)):
                       ~~~~~~~~~~~^^^
  File "/home/karunru/Home/Kaggle/kaggle_monorepo/projects/CMI_Detect_Behavior_with_Sensor_Data/.venv/lib/python3.13/site-packages/pandas/core/frame.py", line 4107, in __getitem__
    indexer = self.columns.get_loc(key)
  File "/home/karunru/Home/Kaggle/kaggle_monorepo/projects/CMI_Detect_Behavior_with_Sensor_Data/.venv/lib/python3.13/site-packages/pandas/core/indexes/base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 0
08/08/2025 12:27:04 AM INFO __main__: Starting cross-validation training
08/08/2025 12:27:04 AM INFO __main__: Configuration: {'experiment': {'exp_num': 'exp010', 'name': 'exp010_early_stopping_with_loss', 'description': 'Early stopping with val_loss instead of val_cmi_score', 'tags': ['imu_only', 'squeezeformer', 'pytorch_lightning', 'early_stopping_loss']}, 'paths': {'output_dir': '../../../outputs/exp010'}, 'data': {'root': '../../../data', 'train_path': '../../../data/train.csv', 'test_path': '../../../data/test.csv', 'tof_mode': 16, 'percentile': 0.95}, 'model': {'name': 'cmi_bert_model', 'imu_dim': 20, 'thm_dim': 5, 'tof_dim': 340, 'feat_dim': 500, 'num_classes': 18, 'imu1_channels': 219, 'imu1_layers': 0, 'imu2_layers': 0, 'imu1_dropout': 0.295, 'imu2_dropout': 0.27, 'thm1_channels': 82, 'thm1_dropout': 0.264, 'thm2_dropout': 0.303, 'tof1_channels': 82, 'tof1_dropout': 0.264, 'tof2_dropout': 0.303, 'bert_layers': 8, 'bert_heads': 10, 'cls1_channels': 937, 'cls2_channels': 303, 'cls1_dropout': 0.228, 'cls2_dropout': 0.225}, 'training': {'seed': 42, 'batch_size': 128, 'num_workers': 4, 'epochs': 100, 'learning_rate': 0.0003, 'weight_decay': 1e-05, 'gradient_clip_val': 1.0, 'scheduler_type': 'cosine', 'scheduler_min_lr': 1e-06, 'scheduler_factor': 0.5, 'scheduler_patience': 5, 'early_stopping_patience': 15, 'use_mixed_precision': True, 'accumulate_grad_batches': 1}, 'loss': {'type': 'cmi', 'alpha': 0.5, 'focal_gamma': 2.0, 'focal_alpha': 1.0}, 'length_grouping': {'enabled': False, 'use_dynamic_padding': False, 'mega_batch_multiplier': 8, 'percentile_max_length': 0.95, 'min_sequence_length': 50, 'max_sequence_length': 500, 'put_longest_first': True, 'fallback_to_fixed_length': True}, 'schedule_free': {'enabled': False, 'optimizer_type': 'RAdamScheduleFree', 'learning_rate_multiplier': 5.0, 'warmup_steps': 1000, 'batch_norm_calibration_steps': 50}, 'ema': {'enabled': True, 'beta': 0.9999, 'update_after_step': 1000, 'update_every': 10, 'update_model_with_ema_every': 1000, 'use_ema_for_validation': True}, 'val': {'name': 'stratified_group_kfold', 'params': {'n_splits': 5, 'random_state': 42, 'target': 'gesture', 'group': 'subject', 'id': 'sequence_id', 'force_recreate': False}}, 'preprocessing': {'target_sequence_length': 200}, 'augmentation': {'gaussian_noise_prob': 0.3, 'gaussian_noise_std': 0.01, 'time_scaling_prob': 0.3, 'time_scaling_range': [0.9, 1.1], 'partial_masking_prob': 0.2, 'partial_masking_length_range': [5, 20], 'partial_masking_ratio': 0.1}, 'logging': {'wandb_enabled': True, 'wandb_project': 'CMI-Detect-Behavior-with-Sensor-Data', 'wandb_name': 'exp010', 'wandb_tags': ['exp010', 'switch_ema', 'squeezeformer']}, 'lightning': {'trainer': {'accelerator': 'auto', 'devices': 'auto', 'precision': '16-mixed', 'deterministic': False, 'benchmark': True, 'enable_checkpointing': True, 'log_every_n_steps': 10, 'check_val_every_n_epoch': 1, 'val_check_interval': 1.0}, 'callbacks': {'model_checkpoint': {'monitor': 'val_cmi_score', 'mode': 'max', 'save_top_k': 1, 'save_last': True, 'filename': 'epoch-{epoch:02d}-val_cmi_score-{val_cmi_score:.4f}', 'auto_insert_metric_name': False}, 'early_stopping': {'monitor': 'val_cmi_score', 'mode': 'max', 'patience': 15, 'min_delta': 0.001, 'verbose': True}, 'lr_monitor': {'logging_interval': 'epoch'}, 'rich_progress_bar': {'enable': False}}}, 'root': '../../../outputs/exp010', 'target_gestures': ['Above ear - pull hair', 'Forehead - pull hairline', 'Forehead - scratch', 'Eyebrow - pull hair', 'Eyelash - pull hair', 'Neck - pinch skin', 'Neck - scratch', 'Cheek - pinch skin'], 'non_target_gestures': ['Drink from bottle/cup', 'Glasses on/off', 'Pull air toward your face', 'Pinch knee/leg skin', 'Scratch knee/leg skin', 'Write name on leg', 'Text on phone', 'Feel around in tray and pull out an object', 'Write name in air', 'Wave hello'], 'imu_features': ['acc_x', 'acc_y', 'acc_z', 'rot_w', 'rot_x', 'rot_y', 'rot_z']}
08/08/2025 12:27:04 AM INFO __main__: Starting training for fold 0
08/08/2025 12:27:08 AM ERROR __main__: Error in fold 0
Traceback (most recent call last):
  File "/home/karunru/Home/Kaggle/kaggle_monorepo/projects/CMI_Detect_Behavior_with_Sensor_Data/.venv/lib/python3.13/site-packages/pandas/core/indexes/base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "pandas/_libs/index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 0

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/karunru/Home/Kaggle/kaggle_monorepo/projects/CMI_Detect_Behavior_with_Sensor_Data/codes/exp/exp010/train.py", line 258, in train_cross_validation
    fold_result = train_single_fold(config, fold, logger, wandb_logger)
  File "/home/karunru/Home/Kaggle/kaggle_monorepo/projects/CMI_Detect_Behavior_with_Sensor_Data/codes/exp/exp010/train.py", line 129, in train_single_fold
    data_module.setup("fit")
    ~~~~~~~~~~~~~~~~~^^^^^^^
  File "/home/karunru/Home/Kaggle/kaggle_monorepo/projects/CMI_Detect_Behavior_with_Sensor_Data/codes/src/utils/timer.py", line 39, in wrapper
    result = func(*args, **kwargs)
  File "/home/karunru/Home/Kaggle/kaggle_monorepo/projects/CMI_Detect_Behavior_with_Sensor_Data/codes/exp/exp010/dataset.py", line 818, in setup
    self.train_dataset = IMUDataset(
                         ~~~~~~~~~~^
        train_sequence_ids,
        ^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
        percentile=self.percentile,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/home/karunru/Home/Kaggle/kaggle_monorepo/projects/CMI_Detect_Behavior_with_Sensor_Data/codes/exp/exp010/dataset.py", line 346, in __init__
    self._preprocess_data()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "/home/karunru/Home/Kaggle/kaggle_monorepo/projects/CMI_Detect_Behavior_with_Sensor_Data/codes/src/utils/timer.py", line 39, in wrapper
    result = func(*args, **kwargs)
  File "/home/karunru/Home/Kaggle/kaggle_monorepo/projects/CMI_Detect_Behavior_with_Sensor_Data/codes/exp/exp010/dataset.py", line 481, in _preprocess_data
    self.df = self._apply_feature_engineering(self.df)
              ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^
  File "/home/karunru/Home/Kaggle/kaggle_monorepo/projects/CMI_Detect_Behavior_with_Sensor_Data/codes/exp/exp010/dataset.py", line 510, in _apply_feature_engineering
    linear_accel = remove_gravity_from_acc(acc_data, rot_data)
  File "/home/karunru/Home/Kaggle/kaggle_monorepo/projects/CMI_Detect_Behavior_with_Sensor_Data/codes/exp/exp010/dataset.py", line 44, in remove_gravity_from_acc
    if np.all(np.isnan(quat_values[i])) or np.all(np.isclose(quat_values[i], 0)):
                       ~~~~~~~~~~~^^^
  File "/home/karunru/Home/Kaggle/kaggle_monorepo/projects/CMI_Detect_Behavior_with_Sensor_Data/.venv/lib/python3.13/site-packages/pandas/core/frame.py", line 4107, in __getitem__
    indexer = self.columns.get_loc(key)
  File "/home/karunru/Home/Kaggle/kaggle_monorepo/projects/CMI_Detect_Behavior_with_Sensor_Data/.venv/lib/python3.13/site-packages/pandas/core/indexes/base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 0
08/08/2025 08:03:51 PM INFO __main__: Starting cross-validation training
08/08/2025 08:03:51 PM INFO __main__: Configuration: {'experiment': {'exp_num': 'exp010', 'name': 'exp010_early_stopping_with_loss', 'description': 'Early stopping with val_loss instead of val_cmi_score', 'tags': ['imu_only', 'squeezeformer', 'pytorch_lightning', 'early_stopping_loss']}, 'paths': {'output_dir': '../../../outputs/exp010'}, 'data': {'root': '../../../data', 'train_path': '../../../data/train.csv', 'test_path': '../../../data/test.csv', 'tof_mode': 16, 'percentile': 0.95}, 'model': {'name': 'cmi_bert_model', 'imu_dim': 20, 'thm_dim': 5, 'tof_dim': 340, 'feat_dim': 500, 'num_classes': 18, 'imu1_channels': 219, 'imu1_layers': 0, 'imu2_layers': 0, 'imu1_dropout': 0.295, 'imu2_dropout': 0.27, 'thm1_channels': 82, 'thm1_dropout': 0.264, 'thm2_dropout': 0.303, 'tof1_channels': 82, 'tof1_dropout': 0.264, 'tof2_dropout': 0.303, 'bert_layers': 8, 'bert_heads': 10, 'cls1_channels': 937, 'cls2_channels': 303, 'cls1_dropout': 0.228, 'cls2_dropout': 0.225}, 'training': {'seed': 42, 'batch_size': 128, 'num_workers': 4, 'epochs': 100, 'learning_rate': 0.0003, 'weight_decay': 1e-05, 'gradient_clip_val': 1.0, 'scheduler_type': 'cosine', 'scheduler_min_lr': 1e-06, 'scheduler_factor': 0.5, 'scheduler_patience': 5, 'early_stopping_patience': 15, 'use_mixed_precision': True, 'accumulate_grad_batches': 1}, 'loss': {'type': 'cmi', 'alpha': 0.5, 'focal_gamma': 2.0, 'focal_alpha': 1.0}, 'length_grouping': {'enabled': False, 'use_dynamic_padding': False, 'mega_batch_multiplier': 8, 'percentile_max_length': 0.95, 'min_sequence_length': 50, 'max_sequence_length': 500, 'put_longest_first': True, 'fallback_to_fixed_length': True}, 'schedule_free': {'enabled': False, 'optimizer_type': 'RAdamScheduleFree', 'learning_rate_multiplier': 5.0, 'warmup_steps': 1000, 'batch_norm_calibration_steps': 50}, 'ema': {'enabled': True, 'beta': 0.9999, 'update_after_step': 1000, 'update_every': 10, 'update_model_with_ema_every': 1000, 'use_ema_for_validation': True}, 'val': {'name': 'stratified_group_kfold', 'params': {'n_splits': 5, 'random_state': 42, 'target': 'gesture', 'group': 'subject', 'id': 'sequence_id', 'force_recreate': False}}, 'preprocessing': {'target_sequence_length': 200}, 'augmentation': {'gaussian_noise_prob': 0.3, 'gaussian_noise_std': 0.01, 'time_scaling_prob': 0.3, 'time_scaling_range': [0.9, 1.1], 'partial_masking_prob': 0.2, 'partial_masking_length_range': [5, 20], 'partial_masking_ratio': 0.1}, 'logging': {'wandb_enabled': True, 'wandb_project': 'CMI-Detect-Behavior-with-Sensor-Data', 'wandb_name': 'exp010', 'wandb_tags': ['exp010', 'switch_ema', 'squeezeformer']}, 'lightning': {'trainer': {'accelerator': 'auto', 'devices': 'auto', 'precision': '16-mixed', 'deterministic': False, 'benchmark': True, 'enable_checkpointing': True, 'log_every_n_steps': 10, 'check_val_every_n_epoch': 1, 'val_check_interval': 1.0}, 'callbacks': {'model_checkpoint': {'monitor': 'val_cmi_score', 'mode': 'max', 'save_top_k': 1, 'save_last': True, 'filename': 'epoch-{epoch:02d}-val_cmi_score-{val_cmi_score:.4f}', 'auto_insert_metric_name': False}, 'early_stopping': {'monitor': 'val_cmi_score', 'mode': 'max', 'patience': 15, 'min_delta': 0.001, 'verbose': True}, 'lr_monitor': {'logging_interval': 'epoch'}, 'rich_progress_bar': {'enable': False}}}, 'root': '../../../outputs/exp010', 'target_gestures': ['Above ear - pull hair', 'Forehead - pull hairline', 'Forehead - scratch', 'Eyebrow - pull hair', 'Eyelash - pull hair', 'Neck - pinch skin', 'Neck - scratch', 'Cheek - pinch skin'], 'non_target_gestures': ['Drink from bottle/cup', 'Glasses on/off', 'Pull air toward your face', 'Pinch knee/leg skin', 'Scratch knee/leg skin', 'Write name on leg', 'Text on phone', 'Feel around in tray and pull out an object', 'Write name in air', 'Wave hello'], 'imu_features': ['acc_x', 'acc_y', 'acc_z', 'rot_w', 'rot_x', 'rot_y', 'rot_z']}
08/08/2025 08:03:51 PM INFO __main__: Starting training for fold 0
08/08/2025 08:04:52 PM INFO __main__: Starting cross-validation training
08/08/2025 08:04:52 PM INFO __main__: Configuration: {'experiment': {'exp_num': 'exp010', 'name': 'exp010_early_stopping_with_loss', 'description': 'Early stopping with val_loss instead of val_cmi_score', 'tags': ['imu_only', 'squeezeformer', 'pytorch_lightning', 'early_stopping_loss']}, 'paths': {'output_dir': '../../../outputs/exp010'}, 'data': {'root': '../../../data', 'train_path': '../../../data/train.csv', 'test_path': '../../../data/test.csv', 'tof_mode': 16, 'percentile': 0.95}, 'model': {'name': 'cmi_bert_model', 'imu_dim': 20, 'thm_dim': 5, 'tof_dim': 340, 'feat_dim': 500, 'num_classes': 18, 'imu1_channels': 219, 'imu1_layers': 0, 'imu2_layers': 0, 'imu1_dropout': 0.295, 'imu2_dropout': 0.27, 'thm1_channels': 82, 'thm1_dropout': 0.264, 'thm2_dropout': 0.303, 'tof1_channels': 82, 'tof1_dropout': 0.264, 'tof2_dropout': 0.303, 'bert_layers': 8, 'bert_heads': 10, 'cls1_channels': 937, 'cls2_channels': 303, 'cls1_dropout': 0.228, 'cls2_dropout': 0.225}, 'training': {'seed': 42, 'batch_size': 128, 'num_workers': 4, 'epochs': 100, 'learning_rate': 0.0003, 'weight_decay': 1e-05, 'gradient_clip_val': 1.0, 'scheduler_type': 'cosine', 'scheduler_min_lr': 1e-06, 'scheduler_factor': 0.5, 'scheduler_patience': 5, 'early_stopping_patience': 15, 'use_mixed_precision': True, 'accumulate_grad_batches': 1}, 'loss': {'type': 'cmi', 'alpha': 0.5, 'focal_gamma': 2.0, 'focal_alpha': 1.0}, 'length_grouping': {'enabled': False, 'use_dynamic_padding': False, 'mega_batch_multiplier': 8, 'percentile_max_length': 0.95, 'min_sequence_length': 50, 'max_sequence_length': 500, 'put_longest_first': True, 'fallback_to_fixed_length': True}, 'schedule_free': {'enabled': False, 'optimizer_type': 'RAdamScheduleFree', 'learning_rate_multiplier': 5.0, 'warmup_steps': 1000, 'batch_norm_calibration_steps': 50}, 'ema': {'enabled': True, 'beta': 0.9999, 'update_after_step': 1000, 'update_every': 10, 'update_model_with_ema_every': 1000, 'use_ema_for_validation': True}, 'val': {'name': 'stratified_group_kfold', 'params': {'n_splits': 5, 'random_state': 42, 'target': 'gesture', 'group': 'subject', 'id': 'sequence_id', 'force_recreate': False}}, 'preprocessing': {'target_sequence_length': 200}, 'augmentation': {'gaussian_noise_prob': 0.3, 'gaussian_noise_std': 0.01, 'time_scaling_prob': 0.3, 'time_scaling_range': [0.9, 1.1], 'partial_masking_prob': 0.2, 'partial_masking_length_range': [5, 20], 'partial_masking_ratio': 0.1}, 'logging': {'wandb_enabled': True, 'wandb_project': 'CMI-Detect-Behavior-with-Sensor-Data', 'wandb_name': 'exp010', 'wandb_tags': ['exp010', 'switch_ema', 'squeezeformer']}, 'lightning': {'trainer': {'accelerator': 'auto', 'devices': 'auto', 'precision': '16-mixed', 'deterministic': False, 'benchmark': True, 'enable_checkpointing': True, 'log_every_n_steps': 10, 'check_val_every_n_epoch': 1, 'val_check_interval': 1.0}, 'callbacks': {'model_checkpoint': {'monitor': 'val_cmi_score', 'mode': 'max', 'save_top_k': 1, 'save_last': True, 'filename': 'epoch-{epoch:02d}-val_cmi_score-{val_cmi_score:.4f}', 'auto_insert_metric_name': False}, 'early_stopping': {'monitor': 'val_cmi_score', 'mode': 'max', 'patience': 15, 'min_delta': 0.001, 'verbose': True}, 'lr_monitor': {'logging_interval': 'epoch'}, 'rich_progress_bar': {'enable': False}}}, 'root': '../../../outputs/exp010', 'target_gestures': ['Above ear - pull hair', 'Forehead - pull hairline', 'Forehead - scratch', 'Eyebrow - pull hair', 'Eyelash - pull hair', 'Neck - pinch skin', 'Neck - scratch', 'Cheek - pinch skin'], 'non_target_gestures': ['Drink from bottle/cup', 'Glasses on/off', 'Pull air toward your face', 'Pinch knee/leg skin', 'Scratch knee/leg skin', 'Write name on leg', 'Text on phone', 'Feel around in tray and pull out an object', 'Write name in air', 'Wave hello'], 'imu_features': ['acc_x', 'acc_y', 'acc_z', 'rot_w', 'rot_x', 'rot_y', 'rot_z']}
08/08/2025 08:04:52 PM INFO __main__: Starting training for fold 0
08/08/2025 08:32:47 PM INFO __main__: Starting cross-validation training
08/08/2025 08:32:47 PM INFO __main__: Configuration: {'experiment': {'exp_num': 'exp010', 'name': 'exp010_early_stopping_with_loss', 'description': 'Early stopping with val_loss instead of val_cmi_score', 'tags': ['imu_only', 'squeezeformer', 'pytorch_lightning', 'early_stopping_loss']}, 'paths': {'output_dir': '../../../outputs/exp010'}, 'data': {'root': '../../../data', 'train_path': '../../../data/train.csv', 'test_path': '../../../data/test.csv', 'tof_mode': 16, 'percentile': 0.95}, 'model': {'name': 'cmi_bert_model', 'imu_dim': 20, 'thm_dim': 5, 'tof_dim': 340, 'feat_dim': 500, 'num_classes': 18, 'imu1_channels': 219, 'imu1_layers': 0, 'imu2_layers': 0, 'imu1_dropout': 0.295, 'imu2_dropout': 0.27, 'thm1_channels': 82, 'thm1_dropout': 0.264, 'thm2_dropout': 0.303, 'tof1_channels': 82, 'tof1_dropout': 0.264, 'tof2_dropout': 0.303, 'bert_layers': 8, 'bert_heads': 10, 'cls1_channels': 937, 'cls2_channels': 303, 'cls1_dropout': 0.228, 'cls2_dropout': 0.225}, 'training': {'seed': 42, 'batch_size': 128, 'num_workers': 4, 'epochs': 100, 'learning_rate': 0.0003, 'weight_decay': 1e-05, 'gradient_clip_val': 1.0, 'scheduler_type': 'cosine', 'scheduler_min_lr': 1e-06, 'scheduler_factor': 0.5, 'scheduler_patience': 5, 'early_stopping_patience': 15, 'use_mixed_precision': True, 'accumulate_grad_batches': 1}, 'loss': {'type': 'cmi', 'alpha': 0.5, 'focal_gamma': 2.0, 'focal_alpha': 1.0}, 'length_grouping': {'enabled': False, 'use_dynamic_padding': False, 'mega_batch_multiplier': 8, 'percentile_max_length': 0.95, 'min_sequence_length': 50, 'max_sequence_length': 500, 'put_longest_first': True, 'fallback_to_fixed_length': True}, 'schedule_free': {'enabled': False, 'optimizer_type': 'RAdamScheduleFree', 'learning_rate_multiplier': 5.0, 'warmup_steps': 1000, 'batch_norm_calibration_steps': 50}, 'ema': {'enabled': True, 'beta': 0.9999, 'update_after_step': 1000, 'update_every': 10, 'update_model_with_ema_every': 1000, 'use_ema_for_validation': True}, 'val': {'name': 'stratified_group_kfold', 'params': {'n_splits': 5, 'random_state': 42, 'target': 'gesture', 'group': 'subject', 'id': 'sequence_id', 'force_recreate': False}}, 'preprocessing': {'target_sequence_length': 200}, 'augmentation': {'gaussian_noise_prob': 0.3, 'gaussian_noise_std': 0.01, 'time_scaling_prob': 0.3, 'time_scaling_range': [0.9, 1.1], 'partial_masking_prob': 0.2, 'partial_masking_length_range': [5, 20], 'partial_masking_ratio': 0.1}, 'logging': {'wandb_enabled': True, 'wandb_project': 'CMI-Detect-Behavior-with-Sensor-Data', 'wandb_name': 'exp010', 'wandb_tags': ['exp010', 'switch_ema', 'squeezeformer']}, 'lightning': {'trainer': {'accelerator': 'auto', 'devices': 'auto', 'precision': '16-mixed', 'deterministic': False, 'benchmark': True, 'enable_checkpointing': True, 'log_every_n_steps': 10, 'check_val_every_n_epoch': 1, 'val_check_interval': 1.0}, 'callbacks': {'model_checkpoint': {'monitor': 'val_cmi_score', 'mode': 'max', 'save_top_k': 1, 'save_last': True, 'filename': 'epoch-{epoch:02d}-val_cmi_score-{val_cmi_score:.4f}', 'auto_insert_metric_name': False}, 'early_stopping': {'monitor': 'val_cmi_score', 'mode': 'max', 'patience': 15, 'min_delta': 0.001, 'verbose': True}, 'lr_monitor': {'logging_interval': 'epoch'}, 'rich_progress_bar': {'enable': False}}}, 'root': '../../../outputs/exp010', 'target_gestures': ['Above ear - pull hair', 'Forehead - pull hairline', 'Forehead - scratch', 'Eyebrow - pull hair', 'Eyelash - pull hair', 'Neck - pinch skin', 'Neck - scratch', 'Cheek - pinch skin'], 'non_target_gestures': ['Drink from bottle/cup', 'Glasses on/off', 'Pull air toward your face', 'Pinch knee/leg skin', 'Scratch knee/leg skin', 'Write name on leg', 'Text on phone', 'Feel around in tray and pull out an object', 'Write name in air', 'Wave hello'], 'imu_features': ['acc_x', 'acc_y', 'acc_z', 'rot_w', 'rot_x', 'rot_y', 'rot_z']}
08/08/2025 08:32:47 PM INFO __main__: Starting training for fold 0
08/08/2025 09:01:14 PM INFO __main__: Starting cross-validation training
08/08/2025 09:01:14 PM INFO __main__: Configuration: {'experiment': {'exp_num': 'exp010', 'name': 'exp010_early_stopping_with_loss', 'description': 'Early stopping with val_loss instead of val_cmi_score', 'tags': ['imu_only', 'squeezeformer', 'pytorch_lightning', 'early_stopping_loss']}, 'paths': {'output_dir': '../../../outputs/exp010'}, 'data': {'root': '../../../data', 'train_path': '../../../data/train.csv', 'test_path': '../../../data/test.csv', 'tof_mode': 16, 'percentile': 0.95}, 'model': {'name': 'cmi_bert_model', 'imu_dim': 20, 'thm_dim': 5, 'tof_dim': 340, 'feat_dim': 500, 'num_classes': 18, 'imu1_channels': 219, 'imu1_layers': 0, 'imu2_layers': 0, 'imu1_dropout': 0.295, 'imu2_dropout': 0.27, 'thm1_channels': 82, 'thm1_dropout': 0.264, 'thm2_dropout': 0.303, 'tof1_channels': 82, 'tof1_dropout': 0.264, 'tof2_dropout': 0.303, 'bert_layers': 8, 'bert_heads': 10, 'cls1_channels': 937, 'cls2_channels': 303, 'cls1_dropout': 0.228, 'cls2_dropout': 0.225}, 'training': {'seed': 42, 'batch_size': 128, 'num_workers': 4, 'epochs': 100, 'learning_rate': 0.0003, 'weight_decay': 1e-05, 'gradient_clip_val': 1.0, 'scheduler_type': 'cosine', 'scheduler_min_lr': 1e-06, 'scheduler_factor': 0.5, 'scheduler_patience': 5, 'early_stopping_patience': 15, 'use_mixed_precision': True, 'accumulate_grad_batches': 1}, 'loss': {'type': 'cmi', 'alpha': 0.5, 'focal_gamma': 2.0, 'focal_alpha': 1.0}, 'length_grouping': {'enabled': False, 'use_dynamic_padding': False, 'mega_batch_multiplier': 8, 'percentile_max_length': 0.95, 'min_sequence_length': 50, 'max_sequence_length': 500, 'put_longest_first': True, 'fallback_to_fixed_length': True}, 'schedule_free': {'enabled': False, 'optimizer_type': 'RAdamScheduleFree', 'learning_rate_multiplier': 5.0, 'warmup_steps': 1000, 'batch_norm_calibration_steps': 50}, 'ema': {'enabled': True, 'beta': 0.9999, 'update_after_step': 1000, 'update_every': 10, 'update_model_with_ema_every': 1000, 'use_ema_for_validation': True}, 'val': {'name': 'stratified_group_kfold', 'params': {'n_splits': 5, 'random_state': 42, 'target': 'gesture', 'group': 'subject', 'id': 'sequence_id', 'force_recreate': False}}, 'preprocessing': {'target_sequence_length': 200}, 'augmentation': {'gaussian_noise_prob': 0.3, 'gaussian_noise_std': 0.01, 'time_scaling_prob': 0.3, 'time_scaling_range': [0.9, 1.1], 'partial_masking_prob': 0.2, 'partial_masking_length_range': [5, 20], 'partial_masking_ratio': 0.1}, 'logging': {'wandb_enabled': True, 'wandb_project': 'CMI-Detect-Behavior-with-Sensor-Data', 'wandb_name': 'exp010', 'wandb_tags': ['exp010', 'switch_ema', 'squeezeformer']}, 'lightning': {'trainer': {'accelerator': 'auto', 'devices': 'auto', 'precision': '16-mixed', 'deterministic': False, 'benchmark': True, 'enable_checkpointing': True, 'log_every_n_steps': 10, 'check_val_every_n_epoch': 1, 'val_check_interval': 1.0}, 'callbacks': {'model_checkpoint': {'monitor': 'val_cmi_score', 'mode': 'max', 'save_top_k': 1, 'save_last': True, 'filename': 'epoch-{epoch:02d}-val_cmi_score-{val_cmi_score:.4f}', 'auto_insert_metric_name': False}, 'early_stopping': {'monitor': 'val_cmi_score', 'mode': 'max', 'patience': 15, 'min_delta': 0.001, 'verbose': True}, 'lr_monitor': {'logging_interval': 'epoch'}, 'rich_progress_bar': {'enable': False}}}, 'root': '../../../outputs/exp010', 'target_gestures': ['Above ear - pull hair', 'Forehead - pull hairline', 'Forehead - scratch', 'Eyebrow - pull hair', 'Eyelash - pull hair', 'Neck - pinch skin', 'Neck - scratch', 'Cheek - pinch skin'], 'non_target_gestures': ['Drink from bottle/cup', 'Glasses on/off', 'Pull air toward your face', 'Pinch knee/leg skin', 'Scratch knee/leg skin', 'Write name on leg', 'Text on phone', 'Feel around in tray and pull out an object', 'Write name in air', 'Wave hello'], 'imu_features': ['acc_x', 'acc_y', 'acc_z', 'rot_w', 'rot_x', 'rot_y', 'rot_z']}
08/08/2025 09:01:15 PM INFO __main__: Starting training for fold 0
08/08/2025 09:21:38 PM INFO __main__: Starting cross-validation training
08/08/2025 09:21:38 PM INFO __main__: Configuration: {'experiment': {'exp_num': 'exp010', 'name': 'exp010_early_stopping_with_loss', 'description': 'Early stopping with val_loss instead of val_cmi_score', 'tags': ['imu_only', 'squeezeformer', 'pytorch_lightning', 'early_stopping_loss']}, 'paths': {'output_dir': '../../../outputs/exp010'}, 'data': {'root': '../../../data', 'train_path': '../../../data/train.csv', 'test_path': '../../../data/test.csv', 'tof_mode': 16, 'percentile': 0.95}, 'model': {'name': 'cmi_bert_model', 'imu_dim': 20, 'thm_dim': 5, 'tof_dim': 340, 'feat_dim': 500, 'num_classes': 18, 'imu1_channels': 219, 'imu1_layers': 0, 'imu2_layers': 0, 'imu1_dropout': 0.295, 'imu2_dropout': 0.27, 'thm1_channels': 82, 'thm1_dropout': 0.264, 'thm2_dropout': 0.303, 'tof1_channels': 82, 'tof1_dropout': 0.264, 'tof2_dropout': 0.303, 'bert_layers': 8, 'bert_heads': 10, 'cls1_channels': 937, 'cls2_channels': 303, 'cls1_dropout': 0.228, 'cls2_dropout': 0.225}, 'training': {'seed': 42, 'batch_size': 128, 'num_workers': 4, 'epochs': 100, 'learning_rate': 0.0003, 'weight_decay': 1e-05, 'gradient_clip_val': 1.0, 'scheduler_type': 'cosine', 'scheduler_min_lr': 1e-06, 'scheduler_factor': 0.5, 'scheduler_patience': 5, 'early_stopping_patience': 15, 'use_mixed_precision': True, 'accumulate_grad_batches': 1}, 'loss': {'type': 'cmi', 'alpha': 0.5, 'focal_gamma': 2.0, 'focal_alpha': 1.0}, 'length_grouping': {'enabled': False, 'use_dynamic_padding': False, 'mega_batch_multiplier': 8, 'percentile_max_length': 0.95, 'min_sequence_length': 50, 'max_sequence_length': 500, 'put_longest_first': True, 'fallback_to_fixed_length': True}, 'schedule_free': {'enabled': False, 'optimizer_type': 'RAdamScheduleFree', 'learning_rate_multiplier': 5.0, 'warmup_steps': 1000, 'batch_norm_calibration_steps': 50}, 'ema': {'enabled': True, 'beta': 0.9999, 'update_after_step': 1000, 'update_every': 10, 'update_model_with_ema_every': 1000, 'use_ema_for_validation': True}, 'val': {'name': 'stratified_group_kfold', 'params': {'n_splits': 5, 'random_state': 42, 'target': 'gesture', 'group': 'subject', 'id': 'sequence_id', 'force_recreate': False}}, 'preprocessing': {'target_sequence_length': 200}, 'augmentation': {'gaussian_noise_prob': 0.3, 'gaussian_noise_std': 0.01, 'time_scaling_prob': 0.3, 'time_scaling_range': [0.9, 1.1], 'partial_masking_prob': 0.2, 'partial_masking_length_range': [5, 20], 'partial_masking_ratio': 0.1}, 'logging': {'wandb_enabled': True, 'wandb_project': 'CMI-Detect-Behavior-with-Sensor-Data', 'wandb_name': 'exp010', 'wandb_tags': ['exp010', 'switch_ema', 'squeezeformer']}, 'lightning': {'trainer': {'accelerator': 'auto', 'devices': 'auto', 'precision': '16-mixed', 'deterministic': False, 'benchmark': True, 'enable_checkpointing': True, 'log_every_n_steps': 10, 'check_val_every_n_epoch': 1, 'val_check_interval': 1.0}, 'callbacks': {'model_checkpoint': {'monitor': 'val_cmi_score', 'mode': 'max', 'save_top_k': 1, 'save_last': True, 'filename': 'epoch-{epoch:02d}-val_cmi_score-{val_cmi_score:.4f}', 'auto_insert_metric_name': False}, 'early_stopping': {'monitor': 'val_cmi_score', 'mode': 'max', 'patience': 15, 'min_delta': 0.001, 'verbose': True}, 'lr_monitor': {'logging_interval': 'epoch'}, 'rich_progress_bar': {'enable': False}}}, 'root': '../../../outputs/exp010', 'target_gestures': ['Above ear - pull hair', 'Forehead - pull hairline', 'Forehead - scratch', 'Eyebrow - pull hair', 'Eyelash - pull hair', 'Neck - pinch skin', 'Neck - scratch', 'Cheek - pinch skin'], 'non_target_gestures': ['Drink from bottle/cup', 'Glasses on/off', 'Pull air toward your face', 'Pinch knee/leg skin', 'Scratch knee/leg skin', 'Write name on leg', 'Text on phone', 'Feel around in tray and pull out an object', 'Write name in air', 'Wave hello'], 'imu_features': ['acc_x', 'acc_y', 'acc_z', 'rot_w', 'rot_x', 'rot_y', 'rot_z']}
08/08/2025 09:21:38 PM INFO __main__: Starting training for fold 0
08/08/2025 09:30:24 PM INFO __main__: Starting cross-validation training
08/08/2025 09:30:24 PM INFO __main__: Configuration: {'experiment': {'exp_num': 'exp010', 'name': 'exp010_early_stopping_with_loss', 'description': 'Early stopping with val_loss instead of val_cmi_score', 'tags': ['imu_only', 'squeezeformer', 'pytorch_lightning', 'early_stopping_loss']}, 'paths': {'output_dir': '../../../outputs/exp010'}, 'data': {'root': '../../../data', 'train_path': '../../../data/train.csv', 'test_path': '../../../data/test.csv', 'tof_mode': 16, 'percentile': 0.95}, 'model': {'name': 'cmi_bert_model', 'imu_dim': 20, 'thm_dim': 5, 'tof_dim': 340, 'feat_dim': 500, 'num_classes': 18, 'imu1_channels': 219, 'imu1_layers': 0, 'imu2_layers': 0, 'imu1_dropout': 0.295, 'imu2_dropout': 0.27, 'thm1_channels': 82, 'thm1_dropout': 0.264, 'thm2_dropout': 0.303, 'tof1_channels': 82, 'tof1_dropout': 0.264, 'tof2_dropout': 0.303, 'bert_layers': 8, 'bert_heads': 10, 'cls1_channels': 937, 'cls2_channels': 303, 'cls1_dropout': 0.228, 'cls2_dropout': 0.225}, 'training': {'seed': 42, 'batch_size': 128, 'num_workers': 4, 'epochs': 100, 'learning_rate': 0.0003, 'weight_decay': 1e-05, 'gradient_clip_val': 1.0, 'scheduler_type': 'cosine', 'scheduler_min_lr': 1e-06, 'scheduler_factor': 0.5, 'scheduler_patience': 5, 'early_stopping_patience': 15, 'use_mixed_precision': True, 'accumulate_grad_batches': 1}, 'loss': {'type': 'cmi', 'alpha': 0.5, 'focal_gamma': 2.0, 'focal_alpha': 1.0}, 'length_grouping': {'enabled': False, 'use_dynamic_padding': False, 'mega_batch_multiplier': 8, 'percentile_max_length': 0.95, 'min_sequence_length': 50, 'max_sequence_length': 500, 'put_longest_first': True, 'fallback_to_fixed_length': True}, 'schedule_free': {'enabled': False, 'optimizer_type': 'RAdamScheduleFree', 'learning_rate_multiplier': 5.0, 'warmup_steps': 1000, 'batch_norm_calibration_steps': 50}, 'ema': {'enabled': True, 'beta': 0.9999, 'update_after_step': 1000, 'update_every': 10, 'update_model_with_ema_every': 1000, 'use_ema_for_validation': True}, 'val': {'name': 'stratified_group_kfold', 'params': {'n_splits': 5, 'random_state': 42, 'target': 'gesture', 'group': 'subject', 'id': 'sequence_id', 'force_recreate': False}}, 'preprocessing': {'target_sequence_length': 200}, 'augmentation': {'gaussian_noise_prob': 0.3, 'gaussian_noise_std': 0.01, 'time_scaling_prob': 0.3, 'time_scaling_range': [0.9, 1.1], 'partial_masking_prob': 0.2, 'partial_masking_length_range': [5, 20], 'partial_masking_ratio': 0.1}, 'logging': {'wandb_enabled': True, 'wandb_project': 'CMI-Detect-Behavior-with-Sensor-Data', 'wandb_name': 'exp010', 'wandb_tags': ['exp010', 'switch_ema', 'squeezeformer']}, 'lightning': {'trainer': {'accelerator': 'auto', 'devices': 'auto', 'precision': '16-mixed', 'deterministic': False, 'benchmark': True, 'enable_checkpointing': True, 'log_every_n_steps': 10, 'check_val_every_n_epoch': 1, 'val_check_interval': 1.0}, 'callbacks': {'model_checkpoint': {'monitor': 'val_cmi_score', 'mode': 'max', 'save_top_k': 1, 'save_last': True, 'filename': 'epoch-{epoch:02d}-val_cmi_score-{val_cmi_score:.4f}', 'auto_insert_metric_name': False}, 'early_stopping': {'monitor': 'val_cmi_score', 'mode': 'max', 'patience': 15, 'min_delta': 0.001, 'verbose': True}, 'lr_monitor': {'logging_interval': 'epoch'}, 'rich_progress_bar': {'enable': False}}}, 'root': '../../../outputs/exp010', 'target_gestures': ['Above ear - pull hair', 'Forehead - pull hairline', 'Forehead - scratch', 'Eyebrow - pull hair', 'Eyelash - pull hair', 'Neck - pinch skin', 'Neck - scratch', 'Cheek - pinch skin'], 'non_target_gestures': ['Drink from bottle/cup', 'Glasses on/off', 'Pull air toward your face', 'Pinch knee/leg skin', 'Scratch knee/leg skin', 'Write name on leg', 'Text on phone', 'Feel around in tray and pull out an object', 'Write name in air', 'Wave hello'], 'imu_features': ['acc_x', 'acc_y', 'acc_z', 'rot_w', 'rot_x', 'rot_y', 'rot_z']}
08/08/2025 09:30:24 PM INFO __main__: Starting training for fold 0
08/08/2025 09:31:20 PM ERROR __main__: Error in fold 0
Traceback (most recent call last):
  File "/home/karunru/Home/Kaggle/kaggle_monorepo/projects/CMI_Detect_Behavior_with_Sensor_Data/codes/exp/exp010/train.py", line 258, in train_cross_validation
    fold_result = train_single_fold(config, fold, logger, wandb_logger)
  File "/home/karunru/Home/Kaggle/kaggle_monorepo/projects/CMI_Detect_Behavior_with_Sensor_Data/codes/exp/exp010/train.py", line 181, in train_single_fold
    trainer.fit(model, data_module)
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^
  File "/home/karunru/Home/Kaggle/kaggle_monorepo/projects/CMI_Detect_Behavior_with_Sensor_Data/.venv/lib/python3.13/site-packages/pytorch_lightning/trainer/trainer.py", line 561, in fit
    call._call_and_handle_interrupt(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, self._fit_impl, model, train_dataloaders, val_dataloaders, datamodule, ckpt_path
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/home/karunru/Home/Kaggle/kaggle_monorepo/projects/CMI_Detect_Behavior_with_Sensor_Data/.venv/lib/python3.13/site-packages/pytorch_lightning/trainer/call.py", line 48, in _call_and_handle_interrupt
    return trainer_fn(*args, **kwargs)
  File "/home/karunru/Home/Kaggle/kaggle_monorepo/projects/CMI_Detect_Behavior_with_Sensor_Data/.venv/lib/python3.13/site-packages/pytorch_lightning/trainer/trainer.py", line 599, in _fit_impl
    self._run(model, ckpt_path=ckpt_path)
    ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/karunru/Home/Kaggle/kaggle_monorepo/projects/CMI_Detect_Behavior_with_Sensor_Data/.venv/lib/python3.13/site-packages/pytorch_lightning/trainer/trainer.py", line 974, in _run
    call._call_setup_hook(self)  # allow user to set up LightningModule in accelerator environment
    ~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/home/karunru/Home/Kaggle/kaggle_monorepo/projects/CMI_Detect_Behavior_with_Sensor_Data/.venv/lib/python3.13/site-packages/pytorch_lightning/trainer/call.py", line 107, in _call_setup_hook
    _call_lightning_datamodule_hook(trainer, "setup", stage=fn)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/karunru/Home/Kaggle/kaggle_monorepo/projects/CMI_Detect_Behavior_with_Sensor_Data/.venv/lib/python3.13/site-packages/pytorch_lightning/trainer/call.py", line 198, in _call_lightning_datamodule_hook
    return fn(*args, **kwargs)
  File "/home/karunru/Home/Kaggle/kaggle_monorepo/projects/CMI_Detect_Behavior_with_Sensor_Data/codes/src/utils/timer.py", line 39, in wrapper
    result = func(*args, **kwargs)
  File "/home/karunru/Home/Kaggle/kaggle_monorepo/projects/CMI_Detect_Behavior_with_Sensor_Data/codes/exp/exp010/dataset.py", line 880, in setup
    self.train_dataset = IMUDataset(
                         ~~~~~~~~~~^
        train_sequence_ids,
        ^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
        percentile=self.percentile,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/home/karunru/Home/Kaggle/kaggle_monorepo/projects/CMI_Detect_Behavior_with_Sensor_Data/codes/exp/exp010/dataset.py", line 346, in __init__
    self._preprocess_data()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "/home/karunru/Home/Kaggle/kaggle_monorepo/projects/CMI_Detect_Behavior_with_Sensor_Data/codes/src/utils/timer.py", line 39, in wrapper
    result = func(*args, **kwargs)
  File "/home/karunru/Home/Kaggle/kaggle_monorepo/projects/CMI_Detect_Behavior_with_Sensor_Data/codes/exp/exp010/dataset.py", line 484, in _preprocess_data
    self.sequence_data = self._preprocess_sequences()
                         ~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/home/karunru/Home/Kaggle/kaggle_monorepo/projects/CMI_Detect_Behavior_with_Sensor_Data/codes/exp/exp010/dataset.py", line 665, in _preprocess_sequences
    for seq_id in tqdm(self.sequence_ids, desc="Processing sequences"):
                  ~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/karunru/Home/Kaggle/kaggle_monorepo/projects/CMI_Detect_Behavior_with_Sensor_Data/.venv/lib/python3.13/site-packages/tqdm/std.py", line 1096, in __init__
    self.sp = self.status_printer(self.fp)
              ~~~~~~~~~~~~~~~~~~~^^^^^^^^^
  File "/home/karunru/Home/Kaggle/kaggle_monorepo/projects/CMI_Detect_Behavior_with_Sensor_Data/.venv/lib/python3.13/site-packages/tqdm/std.py", line 449, in status_printer
    getattr(sys.stdout, 'flush', lambda: None)()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
BrokenPipeError: [Errno 32] Broken pipe
08/08/2025 11:55:08 PM INFO __main__: Starting cross-validation training
08/08/2025 11:55:08 PM INFO __main__: Configuration: {'experiment': {'exp_num': 'exp010', 'name': 'exp010_physics_based_imu_features', 'description': 'Added physics-based IMU features (linear acceleration, angular velocity, angular distance)', 'tags': ['imu_physics', 'squeezeformer', 'pytorch_lightning', 'physics_features']}, 'paths': {'output_dir': '../../../outputs/exp010'}, 'data': {'root': '../../../data', 'train_path': '../../../data/train.csv', 'test_path': '../../../data/test.csv'}, 'model': {'name': 'cmi_squeezeformer', 'input_dim': 16, 'd_model': 256, 'n_layers': 8, 'n_heads': 8, 'd_ff': 1024, 'num_classes': 18, 'kernel_size': 31, 'dropout': 0.1}, 'training': {'seed': 42, 'batch_size': 128, 'num_workers': 4, 'epochs': 100, 'learning_rate': 0.0003, 'weight_decay': 1e-05, 'gradient_clip_val': 1.0, 'scheduler_type': 'cosine', 'scheduler_min_lr': 1e-06, 'scheduler_factor': 0.5, 'scheduler_patience': 5, 'early_stopping_patience': 15, 'use_mixed_precision': True, 'accumulate_grad_batches': 1}, 'loss': {'type': 'cmi', 'alpha': 0.5, 'focal_gamma': 2.0, 'focal_alpha': 1.0}, 'length_grouping': {'enabled': False, 'use_dynamic_padding': False, 'mega_batch_multiplier': 8, 'percentile_max_length': 0.95, 'min_sequence_length': 50, 'max_sequence_length': 500, 'put_longest_first': True, 'fallback_to_fixed_length': True}, 'schedule_free': {'enabled': False, 'optimizer_type': 'RAdamScheduleFree', 'learning_rate_multiplier': 5.0, 'warmup_steps': 1000, 'batch_norm_calibration_steps': 50}, 'ema': {'enabled': True, 'beta': 0.9999, 'update_after_step': 1000, 'update_every': 10, 'update_model_with_ema_every': 1000, 'use_ema_for_validation': True}, 'val': {'name': 'stratified_group_kfold', 'params': {'n_splits': 5, 'random_state': 42, 'target': 'gesture', 'group': 'subject', 'id': 'sequence_id', 'force_recreate': False}}, 'preprocessing': {'target_sequence_length': 200}, 'augmentation': {'gaussian_noise_prob': 0.3, 'gaussian_noise_std': 0.01, 'time_scaling_prob': 0.3, 'time_scaling_range': [0.9, 1.1], 'partial_masking_prob': 0.2, 'partial_masking_length_range': [5, 20], 'partial_masking_ratio': 0.1}, 'logging': {'wandb_enabled': True, 'wandb_project': 'CMI-Detect-Behavior-with-Sensor-Data', 'wandb_name': 'exp010', 'wandb_tags': ['exp010', 'switch_ema', 'squeezeformer']}, 'lightning': {'trainer': {'accelerator': 'auto', 'devices': 'auto', 'precision': '16-mixed', 'deterministic': False, 'benchmark': True, 'enable_checkpointing': True, 'log_every_n_steps': 10, 'check_val_every_n_epoch': 1, 'val_check_interval': 1.0}, 'callbacks': {'model_checkpoint': {'monitor': 'val_cmi_score', 'mode': 'max', 'save_top_k': 1, 'save_last': True, 'filename': 'epoch-{epoch:02d}-val_cmi_score-{val_cmi_score:.4f}', 'auto_insert_metric_name': False}, 'early_stopping': {'monitor': 'val_cmi_score', 'mode': 'max', 'patience': 15, 'min_delta': 0.001, 'verbose': True}, 'lr_monitor': {'logging_interval': 'epoch'}, 'rich_progress_bar': {'enable': False}}}, 'root': '../../../outputs/exp010', 'target_gestures': ['Above ear - pull hair', 'Forehead - pull hairline', 'Forehead - scratch', 'Eyebrow - pull hair', 'Eyelash - pull hair', 'Neck - pinch skin', 'Neck - scratch', 'Cheek - pinch skin'], 'non_target_gestures': ['Drink from bottle/cup', 'Glasses on/off', 'Pull air toward your face', 'Pinch knee/leg skin', 'Scratch knee/leg skin', 'Write name on leg', 'Text on phone', 'Feel around in tray and pull out an object', 'Write name in air', 'Wave hello'], 'imu_features': ['acc_x', 'acc_y', 'acc_z', 'rot_w', 'rot_x', 'rot_y', 'rot_z', 'linear_acc_x', 'linear_acc_y', 'linear_acc_z', 'linear_acc_mag', 'linear_acc_mag_jerk', 'angular_vel_x', 'angular_vel_y', 'angular_vel_z', 'angular_distance']}
08/08/2025 11:55:08 PM INFO __main__: Starting training for fold 0
08/09/2025 12:07:43 AM INFO __main__: Loading best model from: ../../../outputs/exp010/fold_0/version_1/checkpoints/epoch-20-val_cmi_score-0.7402.ckpt
08/09/2025 12:07:45 AM INFO __main__: Fold 0 results: {'fold': 0, 'val_loss': 0.7956461906433105, 'val_cmi_score': 0.7401612997055054, 'val_multiclass_loss': 1.4771960973739624, 'val_binary_loss': 0.11409613490104675, 'best_model_path': '../../../outputs/exp010/fold_0/version_1/checkpoints/epoch-20-val_cmi_score-0.7402.ckpt'}
08/09/2025 12:07:45 AM INFO __main__: Starting training for fold 1
08/09/2025 12:25:28 AM INFO __main__: Loading best model from: ../../../outputs/exp010/fold_1/version_0/checkpoints/epoch-42-val_cmi_score-0.7330.ckpt
08/09/2025 12:25:31 AM INFO __main__: Fold 1 results: {'fold': 1, 'val_loss': 1.348915457725525, 'val_cmi_score': 0.7329534888267517, 'val_multiclass_loss': 2.4756598472595215, 'val_binary_loss': 0.22217102348804474, 'best_model_path': '../../../outputs/exp010/fold_1/version_0/checkpoints/epoch-42-val_cmi_score-0.7330.ckpt'}
08/09/2025 12:25:31 AM INFO __main__: Starting training for fold 2
08/09/2025 12:38:26 AM INFO __main__: Loading best model from: ../../../outputs/exp010/fold_2/version_0/checkpoints/epoch-23-val_cmi_score-0.7469.ckpt
08/09/2025 12:38:29 AM INFO __main__: Fold 2 results: {'fold': 2, 'val_loss': 0.8481979966163635, 'val_cmi_score': 0.7469288110733032, 'val_multiclass_loss': 1.564143180847168, 'val_binary_loss': 0.13225293159484863, 'best_model_path': '../../../outputs/exp010/fold_2/version_0/checkpoints/epoch-23-val_cmi_score-0.7469.ckpt'}
08/09/2025 12:38:29 AM INFO __main__: Starting training for fold 3
08/09/2025 12:51:47 AM INFO __main__: Loading best model from: ../../../outputs/exp010/fold_3/version_0/checkpoints/epoch-25-val_cmi_score-0.7426.ckpt
08/09/2025 12:51:50 AM INFO __main__: Fold 3 results: {'fold': 3, 'val_loss': 0.895322859287262, 'val_cmi_score': 0.74262934923172, 'val_multiclass_loss': 1.6695270538330078, 'val_binary_loss': 0.12111865729093552, 'best_model_path': '../../../outputs/exp010/fold_3/version_0/checkpoints/epoch-25-val_cmi_score-0.7426.ckpt'}
08/09/2025 12:51:50 AM INFO __main__: Starting training for fold 4
08/09/2025 01:09:14 AM INFO __main__: Loading best model from: ../../../outputs/exp010/fold_4/version_0/checkpoints/epoch-42-val_cmi_score-0.7624.ckpt
08/09/2025 01:09:17 AM INFO __main__: Fold 4 results: {'fold': 4, 'val_loss': 1.0368378162384033, 'val_cmi_score': 0.7624312043190002, 'val_multiclass_loss': 1.9239740371704102, 'val_binary_loss': 0.14970143139362335, 'best_model_path': '../../../outputs/exp010/fold_4/version_0/checkpoints/epoch-42-val_cmi_score-0.7624.ckpt'}
08/09/2025 01:09:17 AM INFO __main__: Cross-validation completed
08/09/2025 01:09:17 AM INFO __main__: Mean CV Loss: 0.9850  0.1989
08/09/2025 01:09:17 AM INFO __main__: Mean CV CMI Score: 0.7450  0.0098
08/09/2025 01:09:17 AM INFO __main__: Results saved to: ../../../outputs/exp010/cv_results.csv
08/09/2025 01:09:17 AM INFO __main__: CV results logged to WandB
