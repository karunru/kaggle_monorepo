08/22/2025 12:31:50 AM INFO __main__: Starting cross-validation training
08/22/2025 12:31:50 AM INFO __main__: Configuration: {'experiment': {'exp_num': 'exp042', 'name': 'exp042_configurable_imu_lstm', 'description': 'Configurable IMU-LSTM with Schedule-Free optimization', 'tags': ['imu_only', 'lstm', 'bigru', 'attention', 'residual_se_convnext', 'convnext', 'human_normalization', 'demographics', 'soft_f1_acls', 'bert', 'tsai', 'randaugment', 'imu_rotation', 'handedness_flip', 'orient_head', 'auxiliary_task', 'score_fusion', 'orientation_prior', 'configurable_architecture', 'schedule_free', 'parameter_externalization']}, 'paths': {'output_dir': '../../../outputs/exp042'}, 'data': {'root': '../../../data', 'train_path': '../../../data/train.csv', 'test_path': '../../../data/test.csv', 'demographics_train_path': '../../../data/train_demographics.csv', 'demographics_test_path': '../../../data/test_demographics.csv'}, 'demographics': {'enabled': True, 'embedding_dim': 16, 'categorical_embedding_dims': {'adult_child': 2, 'sex': 2, 'handedness': 2}, 'numerical_scaling_method': 'minmax', 'clip_outliers': True, 'age_min': 8.0, 'age_max': 60.0, 'height_min': 130.0, 'height_max': 195.0, 'shoulder_to_wrist_min': 35.0, 'shoulder_to_wrist_max': 75.0, 'elbow_to_wrist_min': 15.0, 'elbow_to_wrist_max': 50.0, 'categorical_features': ['adult_child', 'sex', 'handedness'], 'numerical_features': ['age', 'height_cm', 'shoulder_to_wrist_cm', 'elbow_to_wrist_cm'], 'hn_enabled': False, 'hn_eps': 0.001, 'hn_radius_min_max': (0.15, 0.9), 'hn_features': ['linear_acc_mag_per_h', 'linear_acc_mag_per_rS', 'linear_acc_mag_per_rE', 'acc_over_centripetal_rS', 'acc_over_centripetal_rE', 'alpha_like_rS', 'alpha_like_rE', 'v_over_h', 'v_over_rS', 'v_over_rE']}, 'model': {'name': 'cmi_squeezeformer_bert', 'input_dim': 20, 'num_classes': 18, 'imu_block1_out_channels': 64, 'imu_block1_kernel_size': 3, 'imu_block1_num_blocks': 2, 'imu_block1_drop_path': 0.1, 'imu_block1_dropout': 0.3, 'imu_block2_out_channels': 128, 'imu_block2_kernel_size': 5, 'imu_block2_num_blocks': 2, 'imu_block2_drop_path': 0.15, 'imu_block2_dropout': 0.3, 'bigru_hidden_size': 128, 'gru_dropout': 0.4, 'dense1_hidden_size': 256, 'dense2_hidden_size': 128, 'dense1_dropout': 0.5, 'dense2_dropout': 0.3, 'multiclass_head_hidden': 64, 'binary_head_hidden': 32, 'nine_class_head_hidden': 64, 'orientation_head_hidden': 32}, 'training': {'seed': 42, 'batch_size': 128, 'num_workers': 8, 'epochs': 200, 'learning_rate': 0.0003, 'weight_decay': 1e-05, 'gradient_clip_val': 0.5, 'scheduler_type': 'cosine', 'scheduler_min_lr': 1e-06, 'scheduler_factor': 0.5, 'scheduler_patience': 5, 'use_mixed_precision': True, 'accumulate_grad_batches': 1}, 'loss': {'type': 'acls', 'alpha': 0.5, 'focal_gamma': 2.0, 'focal_alpha': 1.0, 'soft_f1_beta': 1.0, 'soft_f1_eps': 1e-06, 'label_smoothing': 0.1, 'nine_class_head_enabled': True, 'nine_class_loss_weight': 0.2, 'kl_weight': 0.1, 'kl_temperature': 1.0, 'auto_weighting': 'none', 'auto_weight_clamp': (-10.0, 10.0), 'uncertainty_init_value': 0.0, 'use_mixup': True, 'orient_loss_weight': 0.3}, 'acls': {'label_smoothing_alpha': 0.1, 'mbls_margin': 10.0, 'mbls_alpha': 0.1, 'mbls_schedule': None, 'acls_pos_lambda': 1.0, 'acls_neg_lambda': 0.1, 'acls_alpha': 0.1, 'acls_margin': 10.0}, 'length_grouping': {'enabled': False, 'use_dynamic_padding': False, 'mega_batch_multiplier': 8, 'percentile_max_length': 0.95, 'min_sequence_length': 50, 'max_sequence_length': 500, 'put_longest_first': True, 'fallback_to_fixed_length': True}, 'schedule_free': {'enabled': True, 'optimizer_type': 'RAdamScheduleFree', 'learning_rate_multiplier': 5.0, 'warmup_steps': 1000, 'batch_norm_calibration_steps': 50}, 'ema': {'enabled': True, 'beta': 0.9999, 'update_after_step': 1000, 'update_every': 10, 'update_model_with_ema_every': 1000, 'use_ema_for_validation': True}, 'val': {'name': 'stratified_group_kfold', 'params': {'n_splits': 5, 'random_state': 42, 'target': 'gesture', 'group': 'subject', 'id': 'sequence_id', 'force_recreate': False}}, 'preprocessing': {'target_sequence_length': 200}, 'augmentation': {'enable_randaugment': True, 'randaugment_n': 4, 'randaugment_m': 4.0, 'randaugment_prob': 0.9, 'add_noise_scale': 0.02, 'mag_scale_range': [0.9, 1.1], 'time_warp_max': 0.2, 'crop_ratio': 0.9, 'mask_ratio': 0.1, 'imu_rotation_angle_range': 0.2, 'handedness_flip_prob': 0.0, 'enable_handedness_flip': False, 'gaussian_noise_prob': 0.0, 'gaussian_noise_std': 0.01, 'time_scaling_prob': 0.0, 'time_scaling_range': [0.9, 1.1], 'partial_masking_prob': 0.0, 'partial_masking_length_range': [5, 20], 'partial_masking_ratio': 0.1}, 'logging': {'wandb_enabled': True, 'wandb_project': 'CMI-Detect-Behavior-with-Sensor-Data', 'wandb_name': 'exp042', 'wandb_tags': ['exp042', 'imu_only', 'lstm', 'bigru', 'attention', 'residual_se_convnext', 'convnext', 'human_normalization', 'demographics', 'soft_f1_acls', 'bert', 'tsai', 'randaugment', 'imu_rotation', 'handedness_flip', 'orient_head', 'auxiliary_task', 'score_fusion', 'orientation_prior', 'configurable_architecture', 'schedule_free', 'parameter_externalization']}, 'lightning': {'trainer': {'accelerator': 'auto', 'devices': 'auto', 'precision': '16-mixed', 'deterministic': False, 'benchmark': True, 'enable_checkpointing': True, 'log_every_n_steps': 10, 'check_val_every_n_epoch': 1, 'val_check_interval': 1.0}, 'callbacks': {'model_checkpoint': {'monitor': 'val_cmi_score', 'mode': 'max', 'save_top_k': 1, 'save_last': True, 'filename': 'epoch-{epoch:02d}-val_cmi_score-{val_cmi_score:.4f}', 'auto_insert_metric_name': False}, 'early_stopping': {'monitor': 'val_cmi_score', 'mode': 'max', 'patience': 30, 'min_delta': 0.0001, 'verbose': True}, 'lr_monitor': {'logging_interval': 'epoch'}, 'rich_progress_bar': {'enable': False}}}, 'root': '../../../outputs/exp042', 'target_gestures': ['Above ear - pull hair', 'Forehead - pull hairline', 'Forehead - scratch', 'Eyebrow - pull hair', 'Eyelash - pull hair', 'Neck - pinch skin', 'Neck - scratch', 'Cheek - pinch skin'], 'non_target_gestures': ['Drink from bottle/cup', 'Glasses on/off', 'Pull air toward your face', 'Pinch knee/leg skin', 'Scratch knee/leg skin', 'Write name on leg', 'Text on phone', 'Feel around in tray and pull out an object', 'Write name in air', 'Wave hello'], 'imu_features': ['acc_x', 'acc_y', 'acc_z', 'rot_w', 'rot_x', 'rot_y', 'rot_z', 'linear_acc_x', 'linear_acc_y', 'linear_acc_z', 'linear_acc_mag', 'linear_acc_mag_jerk', 'angular_vel_x', 'angular_vel_y', 'angular_vel_z', 'angular_distance']}
08/22/2025 12:31:50 AM INFO __main__: Starting training for fold 0
08/22/2025 12:33:32 AM INFO __main__: Using input_dim=20 (HN features: False)
08/22/2025 12:33:32 AM ERROR __main__: Error in fold 0
Traceback (most recent call last):
  File "/home/karunru/Home/Kaggle/kaggle_monorepo/projects/CMI_Detect_Behavior_with_Sensor_Data/codes/exp/exp042/train.py", line 239, in train_cross_validation
    fold_result = train_single_fold(config, fold, logger, wandb_logger)
  File "/home/karunru/Home/Kaggle/kaggle_monorepo/projects/CMI_Detect_Behavior_with_Sensor_Data/codes/exp/exp042/train.py", line 136, in train_single_fold
    model = CMISqueezeformer(
        input_dim=actual_input_dim,  # Should be 19 for IMU-only physical features
    ...<13 lines>...
        # Note: Using simplified parameter set for IMUOnlyLSTM architecture with BERT integration
    )
TypeError: CMISqueezeformer.__init__() missing 2 required positional arguments: 'model_config' and 'scheduler_config'
08/22/2025 12:42:08 AM INFO __main__: Starting cross-validation training
08/22/2025 12:42:08 AM INFO __main__: Configuration: {'experiment': {'exp_num': 'exp042', 'name': 'exp042_configurable_imu_lstm', 'description': 'Configurable IMU-LSTM with Schedule-Free optimization', 'tags': ['imu_only', 'lstm', 'bigru', 'attention', 'residual_se_convnext', 'convnext', 'human_normalization', 'demographics', 'soft_f1_acls', 'bert', 'tsai', 'randaugment', 'imu_rotation', 'handedness_flip', 'orient_head', 'auxiliary_task', 'score_fusion', 'orientation_prior', 'configurable_architecture', 'schedule_free', 'parameter_externalization']}, 'paths': {'output_dir': '../../../outputs/exp042'}, 'data': {'root': '../../../data', 'train_path': '../../../data/train.csv', 'test_path': '../../../data/test.csv', 'demographics_train_path': '../../../data/train_demographics.csv', 'demographics_test_path': '../../../data/test_demographics.csv'}, 'demographics': {'enabled': True, 'embedding_dim': 16, 'categorical_embedding_dims': {'adult_child': 2, 'sex': 2, 'handedness': 2}, 'numerical_scaling_method': 'minmax', 'clip_outliers': True, 'age_min': 8.0, 'age_max': 60.0, 'height_min': 130.0, 'height_max': 195.0, 'shoulder_to_wrist_min': 35.0, 'shoulder_to_wrist_max': 75.0, 'elbow_to_wrist_min': 15.0, 'elbow_to_wrist_max': 50.0, 'categorical_features': ['adult_child', 'sex', 'handedness'], 'numerical_features': ['age', 'height_cm', 'shoulder_to_wrist_cm', 'elbow_to_wrist_cm'], 'hn_enabled': False, 'hn_eps': 0.001, 'hn_radius_min_max': (0.15, 0.9), 'hn_features': ['linear_acc_mag_per_h', 'linear_acc_mag_per_rS', 'linear_acc_mag_per_rE', 'acc_over_centripetal_rS', 'acc_over_centripetal_rE', 'alpha_like_rS', 'alpha_like_rE', 'v_over_h', 'v_over_rS', 'v_over_rE']}, 'model': {'name': 'cmi_squeezeformer_bert', 'input_dim': 20, 'num_classes': 18, 'imu_block1_out_channels': 64, 'imu_block1_kernel_size': 3, 'imu_block1_num_blocks': 2, 'imu_block1_drop_path': 0.1, 'imu_block1_dropout': 0.3, 'imu_block2_out_channels': 128, 'imu_block2_kernel_size': 5, 'imu_block2_num_blocks': 2, 'imu_block2_drop_path': 0.15, 'imu_block2_dropout': 0.3, 'bigru_hidden_size': 128, 'gru_dropout': 0.4, 'dense1_hidden_size': 256, 'dense2_hidden_size': 128, 'dense1_dropout': 0.5, 'dense2_dropout': 0.3, 'multiclass_head_hidden': 64, 'binary_head_hidden': 32, 'nine_class_head_hidden': 64, 'orientation_head_hidden': 32}, 'training': {'seed': 42, 'batch_size': 128, 'num_workers': 8, 'epochs': 200, 'learning_rate': 0.0003, 'weight_decay': 1e-05, 'gradient_clip_val': 0.5, 'scheduler_type': 'cosine', 'scheduler_min_lr': 1e-06, 'scheduler_factor': 0.5, 'scheduler_patience': 5, 'use_mixed_precision': True, 'accumulate_grad_batches': 1}, 'loss': {'type': 'acls', 'alpha': 0.5, 'focal_gamma': 2.0, 'focal_alpha': 1.0, 'soft_f1_beta': 1.0, 'soft_f1_eps': 1e-06, 'label_smoothing': 0.1, 'nine_class_head_enabled': True, 'nine_class_loss_weight': 0.2, 'kl_weight': 0.1, 'kl_temperature': 1.0, 'auto_weighting': 'none', 'auto_weight_clamp': (-10.0, 10.0), 'uncertainty_init_value': 0.0, 'use_mixup': True, 'orient_loss_weight': 0.3}, 'acls': {'label_smoothing_alpha': 0.1, 'mbls_margin': 10.0, 'mbls_alpha': 0.1, 'mbls_schedule': None, 'acls_pos_lambda': 1.0, 'acls_neg_lambda': 0.1, 'acls_alpha': 0.1, 'acls_margin': 10.0}, 'length_grouping': {'enabled': False, 'use_dynamic_padding': False, 'mega_batch_multiplier': 8, 'percentile_max_length': 0.95, 'min_sequence_length': 50, 'max_sequence_length': 500, 'put_longest_first': True, 'fallback_to_fixed_length': True}, 'schedule_free': {'enabled': True, 'optimizer_type': 'RAdamScheduleFree', 'learning_rate_multiplier': 5.0, 'warmup_steps': 1000, 'batch_norm_calibration_steps': 50}, 'ema': {'enabled': True, 'beta': 0.9999, 'update_after_step': 1000, 'update_every': 10, 'update_model_with_ema_every': 1000, 'use_ema_for_validation': True}, 'val': {'name': 'stratified_group_kfold', 'params': {'n_splits': 5, 'random_state': 42, 'target': 'gesture', 'group': 'subject', 'id': 'sequence_id', 'force_recreate': False}}, 'preprocessing': {'target_sequence_length': 200}, 'augmentation': {'enable_randaugment': True, 'randaugment_n': 4, 'randaugment_m': 4.0, 'randaugment_prob': 0.9, 'add_noise_scale': 0.02, 'mag_scale_range': [0.9, 1.1], 'time_warp_max': 0.2, 'crop_ratio': 0.9, 'mask_ratio': 0.1, 'imu_rotation_angle_range': 0.2, 'handedness_flip_prob': 0.0, 'enable_handedness_flip': False, 'gaussian_noise_prob': 0.0, 'gaussian_noise_std': 0.01, 'time_scaling_prob': 0.0, 'time_scaling_range': [0.9, 1.1], 'partial_masking_prob': 0.0, 'partial_masking_length_range': [5, 20], 'partial_masking_ratio': 0.1}, 'logging': {'wandb_enabled': True, 'wandb_project': 'CMI-Detect-Behavior-with-Sensor-Data', 'wandb_name': 'exp042', 'wandb_tags': ['exp042', 'imu_only', 'lstm', 'bigru', 'attention', 'residual_se_convnext', 'convnext', 'human_normalization', 'demographics', 'soft_f1_acls', 'bert', 'tsai', 'randaugment', 'imu_rotation', 'handedness_flip', 'orient_head', 'auxiliary_task', 'score_fusion', 'orientation_prior', 'configurable_architecture', 'schedule_free', 'parameter_externalization']}, 'lightning': {'trainer': {'accelerator': 'auto', 'devices': 'auto', 'precision': '16-mixed', 'deterministic': False, 'benchmark': True, 'enable_checkpointing': True, 'log_every_n_steps': 10, 'check_val_every_n_epoch': 1, 'val_check_interval': 1.0}, 'callbacks': {'model_checkpoint': {'monitor': 'val_cmi_score', 'mode': 'max', 'save_top_k': 1, 'save_last': True, 'filename': 'epoch-{epoch:02d}-val_cmi_score-{val_cmi_score:.4f}', 'auto_insert_metric_name': False}, 'early_stopping': {'monitor': 'val_cmi_score', 'mode': 'max', 'patience': 30, 'min_delta': 0.0001, 'verbose': True}, 'lr_monitor': {'logging_interval': 'epoch'}, 'rich_progress_bar': {'enable': False}}}, 'root': '../../../outputs/exp042', 'target_gestures': ['Above ear - pull hair', 'Forehead - pull hairline', 'Forehead - scratch', 'Eyebrow - pull hair', 'Eyelash - pull hair', 'Neck - pinch skin', 'Neck - scratch', 'Cheek - pinch skin'], 'non_target_gestures': ['Drink from bottle/cup', 'Glasses on/off', 'Pull air toward your face', 'Pinch knee/leg skin', 'Scratch knee/leg skin', 'Write name on leg', 'Text on phone', 'Feel around in tray and pull out an object', 'Write name in air', 'Wave hello'], 'imu_features': ['acc_x', 'acc_y', 'acc_z', 'rot_w', 'rot_x', 'rot_y', 'rot_z', 'linear_acc_x', 'linear_acc_y', 'linear_acc_z', 'linear_acc_mag', 'linear_acc_mag_jerk', 'angular_vel_x', 'angular_vel_y', 'angular_vel_z', 'angular_distance']}
08/22/2025 12:42:08 AM INFO __main__: Starting training for fold 0
08/22/2025 12:43:49 AM INFO __main__: Using input_dim=20 (HN features: False)
08/22/2025 12:45:34 AM ERROR __main__: Error in fold 0
Traceback (most recent call last):
  File "/home/karunru/Home/Kaggle/kaggle_monorepo/projects/CMI_Detect_Behavior_with_Sensor_Data/codes/exp/exp042/train.py", line 241, in train_cross_validation
    fold_result = train_single_fold(config, fold, logger, wandb_logger)
  File "/home/karunru/Home/Kaggle/kaggle_monorepo/projects/CMI_Detect_Behavior_with_Sensor_Data/codes/exp/exp042/train.py", line 164, in train_single_fold
    trainer.fit(model, data_module)
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^
  File "/home/karunru/Home/Kaggle/kaggle_monorepo/projects/CMI_Detect_Behavior_with_Sensor_Data/.venv/lib/python3.13/site-packages/pytorch_lightning/trainer/trainer.py", line 561, in fit
    call._call_and_handle_interrupt(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, self._fit_impl, model, train_dataloaders, val_dataloaders, datamodule, ckpt_path
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/home/karunru/Home/Kaggle/kaggle_monorepo/projects/CMI_Detect_Behavior_with_Sensor_Data/.venv/lib/python3.13/site-packages/pytorch_lightning/trainer/call.py", line 48, in _call_and_handle_interrupt
    return trainer_fn(*args, **kwargs)
  File "/home/karunru/Home/Kaggle/kaggle_monorepo/projects/CMI_Detect_Behavior_with_Sensor_Data/.venv/lib/python3.13/site-packages/pytorch_lightning/trainer/trainer.py", line 599, in _fit_impl
    self._run(model, ckpt_path=ckpt_path)
    ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/karunru/Home/Kaggle/kaggle_monorepo/projects/CMI_Detect_Behavior_with_Sensor_Data/.venv/lib/python3.13/site-packages/pytorch_lightning/trainer/trainer.py", line 1012, in _run
    results = self._run_stage()
  File "/home/karunru/Home/Kaggle/kaggle_monorepo/projects/CMI_Detect_Behavior_with_Sensor_Data/.venv/lib/python3.13/site-packages/pytorch_lightning/trainer/trainer.py", line 1056, in _run_stage
    self.fit_loop.run()
    ~~~~~~~~~~~~~~~~~^^
  File "/home/karunru/Home/Kaggle/kaggle_monorepo/projects/CMI_Detect_Behavior_with_Sensor_Data/.venv/lib/python3.13/site-packages/pytorch_lightning/loops/fit_loop.py", line 216, in run
    self.advance()
    ~~~~~~~~~~~~^^
  File "/home/karunru/Home/Kaggle/kaggle_monorepo/projects/CMI_Detect_Behavior_with_Sensor_Data/.venv/lib/python3.13/site-packages/pytorch_lightning/loops/fit_loop.py", line 455, in advance
    self.epoch_loop.run(self._data_fetcher)
    ~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^
  File "/home/karunru/Home/Kaggle/kaggle_monorepo/projects/CMI_Detect_Behavior_with_Sensor_Data/.venv/lib/python3.13/site-packages/pytorch_lightning/loops/training_epoch_loop.py", line 152, in run
    self.advance(data_fetcher)
    ~~~~~~~~~~~~^^^^^^^^^^^^^^
  File "/home/karunru/Home/Kaggle/kaggle_monorepo/projects/CMI_Detect_Behavior_with_Sensor_Data/.venv/lib/python3.13/site-packages/pytorch_lightning/loops/training_epoch_loop.py", line 344, in advance
    batch_output = self.automatic_optimization.run(trainer.optimizers[0], batch_idx, kwargs)
  File "/home/karunru/Home/Kaggle/kaggle_monorepo/projects/CMI_Detect_Behavior_with_Sensor_Data/.venv/lib/python3.13/site-packages/pytorch_lightning/loops/optimization/automatic.py", line 192, in run
    self._optimizer_step(batch_idx, closure)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^
  File "/home/karunru/Home/Kaggle/kaggle_monorepo/projects/CMI_Detect_Behavior_with_Sensor_Data/.venv/lib/python3.13/site-packages/pytorch_lightning/loops/optimization/automatic.py", line 270, in _optimizer_step
    call._call_lightning_module_hook(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        trainer,
        ^^^^^^^^
    ...<4 lines>...
        train_step_and_backward_closure,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/home/karunru/Home/Kaggle/kaggle_monorepo/projects/CMI_Detect_Behavior_with_Sensor_Data/.venv/lib/python3.13/site-packages/pytorch_lightning/trainer/call.py", line 176, in _call_lightning_module_hook
    output = fn(*args, **kwargs)
  File "/home/karunru/Home/Kaggle/kaggle_monorepo/projects/CMI_Detect_Behavior_with_Sensor_Data/.venv/lib/python3.13/site-packages/pytorch_lightning/core/module.py", line 1328, in optimizer_step
    optimizer.step(closure=optimizer_closure)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/karunru/Home/Kaggle/kaggle_monorepo/projects/CMI_Detect_Behavior_with_Sensor_Data/.venv/lib/python3.13/site-packages/pytorch_lightning/core/optimizer.py", line 154, in step
    step_output = self._strategy.optimizer_step(self._optimizer, closure, **kwargs)
  File "/home/karunru/Home/Kaggle/kaggle_monorepo/projects/CMI_Detect_Behavior_with_Sensor_Data/.venv/lib/python3.13/site-packages/pytorch_lightning/strategies/strategy.py", line 239, in optimizer_step
    return self.precision_plugin.optimizer_step(optimizer, model=model, closure=closure, **kwargs)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/karunru/Home/Kaggle/kaggle_monorepo/projects/CMI_Detect_Behavior_with_Sensor_Data/.venv/lib/python3.13/site-packages/pytorch_lightning/plugins/precision/amp.py", line 95, in optimizer_step
    step_output = self.scaler.step(optimizer, **kwargs)  # type: ignore[arg-type]
  File "/home/karunru/Home/Kaggle/kaggle_monorepo/projects/CMI_Detect_Behavior_with_Sensor_Data/.venv/lib/python3.13/site-packages/torch/amp/grad_scaler.py", line 457, in step
    retval = self._maybe_opt_step(optimizer, optimizer_state, *args, **kwargs)
  File "/home/karunru/Home/Kaggle/kaggle_monorepo/projects/CMI_Detect_Behavior_with_Sensor_Data/.venv/lib/python3.13/site-packages/torch/amp/grad_scaler.py", line 352, in _maybe_opt_step
    retval = optimizer.step(*args, **kwargs)
  File "/home/karunru/Home/Kaggle/kaggle_monorepo/projects/CMI_Detect_Behavior_with_Sensor_Data/.venv/lib/python3.13/site-packages/torch/optim/optimizer.py", line 493, in wrapper
    out = func(*args, **kwargs)
  File "/home/karunru/Home/Kaggle/kaggle_monorepo/projects/CMI_Detect_Behavior_with_Sensor_Data/.venv/lib/python3.13/site-packages/torch/utils/_contextlib.py", line 116, in decorate_context
    return func(*args, **kwargs)
  File "/home/karunru/Home/Kaggle/kaggle_monorepo/projects/CMI_Detect_Behavior_with_Sensor_Data/.venv/lib/python3.13/site-packages/schedulefree/radam_schedulefree.py", line 116, in step
    raise Exception(
    ...<3 lines>...
    )
Exception: Optimizer was not in train mode when step is called. Please insert .train() and .eval() calls on the optimizer. See documentation for details.
08/22/2025 12:53:14 AM INFO __main__: Starting cross-validation training
08/22/2025 12:53:14 AM INFO __main__: Configuration: {'experiment': {'exp_num': 'exp042', 'name': 'exp042_configurable_imu_lstm', 'description': 'Configurable IMU-LSTM with Schedule-Free optimization', 'tags': ['imu_only', 'lstm', 'bigru', 'attention', 'residual_se_convnext', 'convnext', 'human_normalization', 'demographics', 'soft_f1_acls', 'bert', 'tsai', 'randaugment', 'imu_rotation', 'handedness_flip', 'orient_head', 'auxiliary_task', 'score_fusion', 'orientation_prior', 'configurable_architecture', 'schedule_free', 'parameter_externalization']}, 'paths': {'output_dir': '../../../outputs/exp042'}, 'data': {'root': '../../../data', 'train_path': '../../../data/train.csv', 'test_path': '../../../data/test.csv', 'demographics_train_path': '../../../data/train_demographics.csv', 'demographics_test_path': '../../../data/test_demographics.csv'}, 'demographics': {'enabled': True, 'embedding_dim': 16, 'categorical_embedding_dims': {'adult_child': 2, 'sex': 2, 'handedness': 2}, 'numerical_scaling_method': 'minmax', 'clip_outliers': True, 'age_min': 8.0, 'age_max': 60.0, 'height_min': 130.0, 'height_max': 195.0, 'shoulder_to_wrist_min': 35.0, 'shoulder_to_wrist_max': 75.0, 'elbow_to_wrist_min': 15.0, 'elbow_to_wrist_max': 50.0, 'categorical_features': ['adult_child', 'sex', 'handedness'], 'numerical_features': ['age', 'height_cm', 'shoulder_to_wrist_cm', 'elbow_to_wrist_cm'], 'hn_enabled': False, 'hn_eps': 0.001, 'hn_radius_min_max': (0.15, 0.9), 'hn_features': ['linear_acc_mag_per_h', 'linear_acc_mag_per_rS', 'linear_acc_mag_per_rE', 'acc_over_centripetal_rS', 'acc_over_centripetal_rE', 'alpha_like_rS', 'alpha_like_rE', 'v_over_h', 'v_over_rS', 'v_over_rE']}, 'model': {'name': 'cmi_squeezeformer_bert', 'input_dim': 20, 'num_classes': 18, 'imu_block1_out_channels': 64, 'imu_block1_kernel_size': 3, 'imu_block1_num_blocks': 2, 'imu_block1_drop_path': 0.1, 'imu_block1_dropout': 0.3, 'imu_block2_out_channels': 128, 'imu_block2_kernel_size': 5, 'imu_block2_num_blocks': 2, 'imu_block2_drop_path': 0.15, 'imu_block2_dropout': 0.3, 'bigru_hidden_size': 128, 'gru_dropout': 0.4, 'dense1_hidden_size': 256, 'dense2_hidden_size': 128, 'dense1_dropout': 0.5, 'dense2_dropout': 0.3, 'multiclass_head_hidden': 64, 'binary_head_hidden': 32, 'nine_class_head_hidden': 64, 'orientation_head_hidden': 32}, 'training': {'seed': 42, 'batch_size': 128, 'num_workers': 8, 'epochs': 200, 'learning_rate': 0.0003, 'weight_decay': 1e-05, 'gradient_clip_val': 0.5, 'scheduler_type': 'cosine', 'scheduler_min_lr': 1e-06, 'scheduler_factor': 0.5, 'scheduler_patience': 5, 'use_mixed_precision': True, 'accumulate_grad_batches': 1}, 'loss': {'type': 'acls', 'alpha': 0.5, 'focal_gamma': 2.0, 'focal_alpha': 1.0, 'soft_f1_beta': 1.0, 'soft_f1_eps': 1e-06, 'label_smoothing': 0.1, 'nine_class_head_enabled': True, 'nine_class_loss_weight': 0.2, 'kl_weight': 0.1, 'kl_temperature': 1.0, 'auto_weighting': 'none', 'auto_weight_clamp': (-10.0, 10.0), 'uncertainty_init_value': 0.0, 'use_mixup': True, 'orient_loss_weight': 0.3}, 'acls': {'label_smoothing_alpha': 0.1, 'mbls_margin': 10.0, 'mbls_alpha': 0.1, 'mbls_schedule': None, 'acls_pos_lambda': 1.0, 'acls_neg_lambda': 0.1, 'acls_alpha': 0.1, 'acls_margin': 10.0}, 'length_grouping': {'enabled': False, 'use_dynamic_padding': False, 'mega_batch_multiplier': 8, 'percentile_max_length': 0.95, 'min_sequence_length': 50, 'max_sequence_length': 500, 'put_longest_first': True, 'fallback_to_fixed_length': True}, 'schedule_free': {'enabled': True, 'optimizer_type': 'RAdamScheduleFree', 'learning_rate_multiplier': 5.0, 'warmup_steps': 1000, 'batch_norm_calibration_steps': 50}, 'ema': {'enabled': True, 'beta': 0.9999, 'update_after_step': 1000, 'update_every': 10, 'update_model_with_ema_every': 1000, 'use_ema_for_validation': True}, 'val': {'name': 'stratified_group_kfold', 'params': {'n_splits': 5, 'random_state': 42, 'target': 'gesture', 'group': 'subject', 'id': 'sequence_id', 'force_recreate': False}}, 'preprocessing': {'target_sequence_length': 200}, 'augmentation': {'enable_randaugment': True, 'randaugment_n': 4, 'randaugment_m': 4.0, 'randaugment_prob': 0.9, 'add_noise_scale': 0.02, 'mag_scale_range': [0.9, 1.1], 'time_warp_max': 0.2, 'crop_ratio': 0.9, 'mask_ratio': 0.1, 'imu_rotation_angle_range': 0.2, 'handedness_flip_prob': 0.0, 'enable_handedness_flip': False, 'gaussian_noise_prob': 0.0, 'gaussian_noise_std': 0.01, 'time_scaling_prob': 0.0, 'time_scaling_range': [0.9, 1.1], 'partial_masking_prob': 0.0, 'partial_masking_length_range': [5, 20], 'partial_masking_ratio': 0.1}, 'logging': {'wandb_enabled': True, 'wandb_project': 'CMI-Detect-Behavior-with-Sensor-Data', 'wandb_name': 'exp042', 'wandb_tags': ['exp042', 'imu_only', 'lstm', 'bigru', 'attention', 'residual_se_convnext', 'convnext', 'human_normalization', 'demographics', 'soft_f1_acls', 'bert', 'tsai', 'randaugment', 'imu_rotation', 'handedness_flip', 'orient_head', 'auxiliary_task', 'score_fusion', 'orientation_prior', 'configurable_architecture', 'schedule_free', 'parameter_externalization']}, 'lightning': {'trainer': {'accelerator': 'auto', 'devices': 'auto', 'precision': '16-mixed', 'deterministic': False, 'benchmark': True, 'enable_checkpointing': True, 'log_every_n_steps': 10, 'check_val_every_n_epoch': 1, 'val_check_interval': 1.0}, 'callbacks': {'model_checkpoint': {'monitor': 'val_cmi_score', 'mode': 'max', 'save_top_k': 1, 'save_last': True, 'filename': 'epoch-{epoch:02d}-val_cmi_score-{val_cmi_score:.4f}', 'auto_insert_metric_name': False}, 'early_stopping': {'monitor': 'val_cmi_score', 'mode': 'max', 'patience': 30, 'min_delta': 0.0001, 'verbose': True}, 'lr_monitor': {'logging_interval': 'epoch'}, 'rich_progress_bar': {'enable': False}}}, 'root': '../../../outputs/exp042', 'target_gestures': ['Above ear - pull hair', 'Forehead - pull hairline', 'Forehead - scratch', 'Eyebrow - pull hair', 'Eyelash - pull hair', 'Neck - pinch skin', 'Neck - scratch', 'Cheek - pinch skin'], 'non_target_gestures': ['Drink from bottle/cup', 'Glasses on/off', 'Pull air toward your face', 'Pinch knee/leg skin', 'Scratch knee/leg skin', 'Write name on leg', 'Text on phone', 'Feel around in tray and pull out an object', 'Write name in air', 'Wave hello'], 'imu_features': ['acc_x', 'acc_y', 'acc_z', 'rot_w', 'rot_x', 'rot_y', 'rot_z', 'linear_acc_x', 'linear_acc_y', 'linear_acc_z', 'linear_acc_mag', 'linear_acc_mag_jerk', 'angular_vel_x', 'angular_vel_y', 'angular_vel_z', 'angular_distance']}
08/22/2025 12:53:14 AM INFO __main__: Starting training for fold 0
08/22/2025 12:54:55 AM INFO __main__: Using input_dim=20 (HN features: False)
08/22/2025 01:02:09 AM INFO __main__: Loading best model from: ../../../outputs/exp042/fold_0/version_1/checkpoints/epoch-120-val_cmi_score-0.7795.ckpt
08/22/2025 01:02:11 AM INFO __main__: Fold 0 results: {'fold': 0, 'val_loss': 1.1648305654525757, 'val_cmi_score': 0.7794769406318665, 'val_multiclass_loss': 1.4441356658935547, 'val_binary_loss': 0.14593255519866943, 'best_model_path': '../../../outputs/exp042/fold_0/version_1/checkpoints/epoch-120-val_cmi_score-0.7795.ckpt'}
08/22/2025 01:02:11 AM INFO __main__: Starting training for fold 1
08/23/2025 12:35:01 AM INFO __main__: Starting cross-validation training
08/23/2025 12:35:01 AM INFO __main__: Configuration: {'experiment': {'exp_num': 'exp042', 'name': 'exp042_configurable_schedule_free', 'description': 'ConvNeXt1D with configurable parameters and Schedule-Free optimizer', 'tags': ['imu_only', 'lstm', 'bigru', 'attention', 'residual_se_convnext', 'convnext', 'human_normalization', 'demographics', 'soft_f1_acls', 'bert', 'tsai', 'randaugment', 'imu_rotation', 'handedness_flip', 'orient_head', 'auxiliary_task', 'score_fusion', 'orientation_prior', 'configurable_model', 'schedule_free']}, 'paths': {'output_dir': '../../../outputs/exp042'}, 'data': {'root': '../../../data', 'train_path': '../../../data/train.csv', 'test_path': '../../../data/test.csv', 'demographics_train_path': '../../../data/train_demographics.csv', 'demographics_test_path': '../../../data/test_demographics.csv'}, 'demographics': {'enabled': True, 'embedding_dim': 16, 'categorical_embedding_dims': {'adult_child': 2, 'sex': 2, 'handedness': 2}, 'numerical_scaling_method': 'minmax', 'clip_outliers': True, 'age_min': 8.0, 'age_max': 60.0, 'height_min': 130.0, 'height_max': 195.0, 'shoulder_to_wrist_min': 35.0, 'shoulder_to_wrist_max': 75.0, 'elbow_to_wrist_min': 15.0, 'elbow_to_wrist_max': 50.0, 'categorical_features': ['adult_child', 'sex', 'handedness'], 'numerical_features': ['age', 'height_cm', 'shoulder_to_wrist_cm', 'elbow_to_wrist_cm'], 'hn_enabled': False, 'hn_eps': 0.001, 'hn_radius_min_max': (0.15, 0.9), 'hn_features': ['linear_acc_mag_per_h', 'linear_acc_mag_per_rS', 'linear_acc_mag_per_rE', 'acc_over_centripetal_rS', 'acc_over_centripetal_rE', 'alpha_like_rS', 'alpha_like_rE', 'v_over_h', 'v_over_rS', 'v_over_rE']}, 'model': {'name': 'cmi_squeezeformer_bert', 'input_dim': 20, 'd_model': 256, 'n_layers': 8, 'n_heads': 8, 'd_ff': 1024, 'num_classes': 18, 'kernel_size': 31, 'dropout': 0.1, 'imu_block1_out_channels': 64, 'imu_block1_kernel_size': 3, 'imu_block1_num_blocks': 2, 'imu_block1_drop_path': 0.1, 'imu_block2_out_channels': 128, 'imu_block2_kernel_size': 5, 'imu_block2_num_blocks': 2, 'imu_block2_drop_path': 0.15, 'bigru_hidden_size': 128, 'gru_dropout': 0.4, 'dense1_dropout': 0.5, 'dense2_dropout': 0.3}, 'training': {'seed': 42, 'batch_size': 128, 'num_workers': 8, 'epochs': 200, 'learning_rate': 0.0003, 'weight_decay': 1e-05, 'gradient_clip_val': 0.5, 'scheduler_type': 'cosine', 'scheduler_min_lr': 1e-06, 'scheduler_factor': 0.5, 'scheduler_patience': 5, 'use_mixed_precision': True, 'accumulate_grad_batches': 1}, 'loss': {'type': 'acls', 'alpha': 0.5, 'focal_gamma': 2.0, 'focal_alpha': 1.0, 'soft_f1_beta': 1.0, 'soft_f1_eps': 1e-06, 'label_smoothing': 0.1, 'nine_class_head_enabled': True, 'nine_class_loss_weight': 0.2, 'kl_weight': 0.1, 'kl_temperature': 1.0, 'auto_weighting': 'none', 'auto_weight_clamp': (-10.0, 10.0), 'uncertainty_init_value': 0.0, 'use_mixup': True, 'orient_loss_weight': 0.3}, 'acls': {'label_smoothing_alpha': 0.1, 'mbls_margin': 10.0, 'mbls_alpha': 0.1, 'mbls_schedule': None, 'acls_pos_lambda': 1.0, 'acls_neg_lambda': 0.1, 'acls_alpha': 0.1, 'acls_margin': 10.0}, 'length_grouping': {'enabled': False, 'use_dynamic_padding': False, 'mega_batch_multiplier': 8, 'percentile_max_length': 0.95, 'min_sequence_length': 50, 'max_sequence_length': 500, 'put_longest_first': True, 'fallback_to_fixed_length': True}, 'schedule_free': {'enabled': True, 'optimizer_type': 'RAdamScheduleFree', 'learning_rate_multiplier': 5.0, 'warmup_steps': 1000, 'batch_norm_calibration_steps': 50}, 'ema': {'enabled': True, 'beta': 0.9999, 'update_after_step': 1000, 'update_every': 10, 'update_model_with_ema_every': 1000, 'use_ema_for_validation': True}, 'val': {'name': 'stratified_group_kfold', 'params': {'n_splits': 5, 'random_state': 42, 'target': 'gesture', 'group': 'subject', 'id': 'sequence_id', 'force_recreate': False}}, 'preprocessing': {'target_sequence_length': 200}, 'augmentation': {'enable_randaugment': True, 'randaugment_n': 4, 'randaugment_m': 4.0, 'randaugment_prob': 0.9, 'add_noise_scale': 0.02, 'mag_scale_range': [0.9, 1.1], 'time_warp_max': 0.2, 'crop_ratio': 0.9, 'mask_ratio': 0.1, 'imu_rotation_angle_range': 0.2, 'handedness_flip_prob': 0.0, 'enable_handedness_flip': False, 'gaussian_noise_prob': 0.0, 'gaussian_noise_std': 0.01, 'time_scaling_prob': 0.0, 'time_scaling_range': [0.9, 1.1], 'partial_masking_prob': 0.0, 'partial_masking_length_range': [5, 20], 'partial_masking_ratio': 0.1}, 'logging': {'wandb_enabled': True, 'wandb_project': 'CMI-Detect-Behavior-with-Sensor-Data', 'wandb_name': 'exp042', 'wandb_tags': ['exp042', 'imu_only', 'lstm', 'bigru', 'attention', 'residual_se_convnext', 'convnext', 'human_normalization', 'demographics', 'soft_f1_acls', 'bert', 'tsai', 'randaugment', 'imu_rotation', 'handedness_flip', 'orient_head', 'auxiliary_task', 'score_fusion', 'orientation_prior', 'configurable_model', 'schedule_free']}, 'lightning': {'trainer': {'accelerator': 'auto', 'devices': 'auto', 'precision': '16-mixed', 'deterministic': False, 'benchmark': True, 'enable_checkpointing': True, 'log_every_n_steps': 10, 'check_val_every_n_epoch': 1, 'val_check_interval': 1.0}, 'callbacks': {'model_checkpoint': {'monitor': 'val_cmi_score', 'mode': 'max', 'save_top_k': 1, 'save_last': True, 'filename': 'epoch-{epoch:02d}-val_cmi_score-{val_cmi_score:.4f}', 'auto_insert_metric_name': False}, 'early_stopping': {'monitor': 'val_cmi_score', 'mode': 'max', 'patience': 30, 'min_delta': 0.0001, 'verbose': True}, 'lr_monitor': {'logging_interval': 'epoch'}, 'rich_progress_bar': {'enable': False}}}, 'root': '../../../outputs/exp042', 'target_gestures': ['Above ear - pull hair', 'Forehead - pull hairline', 'Forehead - scratch', 'Eyebrow - pull hair', 'Eyelash - pull hair', 'Neck - pinch skin', 'Neck - scratch', 'Cheek - pinch skin'], 'non_target_gestures': ['Drink from bottle/cup', 'Glasses on/off', 'Pull air toward your face', 'Pinch knee/leg skin', 'Scratch knee/leg skin', 'Write name on leg', 'Text on phone', 'Feel around in tray and pull out an object', 'Write name in air', 'Wave hello'], 'imu_features': ['acc_x', 'acc_y', 'acc_z', 'rot_w', 'rot_x', 'rot_y', 'rot_z', 'linear_acc_x', 'linear_acc_y', 'linear_acc_z', 'linear_acc_mag', 'linear_acc_mag_jerk', 'angular_vel_x', 'angular_vel_y', 'angular_vel_z', 'angular_distance']}
08/23/2025 12:35:01 AM INFO __main__: Starting training for fold 0
08/23/2025 12:36:43 AM INFO __main__: Using input_dim=20 (HN features: False)
08/23/2025 12:38:25 AM ERROR __main__: Error in fold 0
Traceback (most recent call last):
  File "/home/karunru/Home/Kaggle/kaggle_monorepo/projects/CMI_Detect_Behavior_with_Sensor_Data/codes/exp/exp042/train.py", line 246, in train_cross_validation
    fold_result = train_single_fold(config, fold, logger, wandb_logger)
  File "/home/karunru/Home/Kaggle/kaggle_monorepo/projects/CMI_Detect_Behavior_with_Sensor_Data/codes/exp/exp042/train.py", line 169, in train_single_fold
    trainer.fit(model, data_module)
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^
  File "/home/karunru/Home/Kaggle/kaggle_monorepo/projects/CMI_Detect_Behavior_with_Sensor_Data/.venv/lib/python3.13/site-packages/pytorch_lightning/trainer/trainer.py", line 561, in fit
    call._call_and_handle_interrupt(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, self._fit_impl, model, train_dataloaders, val_dataloaders, datamodule, ckpt_path
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/home/karunru/Home/Kaggle/kaggle_monorepo/projects/CMI_Detect_Behavior_with_Sensor_Data/.venv/lib/python3.13/site-packages/pytorch_lightning/trainer/call.py", line 48, in _call_and_handle_interrupt
    return trainer_fn(*args, **kwargs)
  File "/home/karunru/Home/Kaggle/kaggle_monorepo/projects/CMI_Detect_Behavior_with_Sensor_Data/.venv/lib/python3.13/site-packages/pytorch_lightning/trainer/trainer.py", line 599, in _fit_impl
    self._run(model, ckpt_path=ckpt_path)
    ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/karunru/Home/Kaggle/kaggle_monorepo/projects/CMI_Detect_Behavior_with_Sensor_Data/.venv/lib/python3.13/site-packages/pytorch_lightning/trainer/trainer.py", line 988, in _run
    self.strategy.setup(self)
    ~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/home/karunru/Home/Kaggle/kaggle_monorepo/projects/CMI_Detect_Behavior_with_Sensor_Data/.venv/lib/python3.13/site-packages/pytorch_lightning/strategies/strategy.py", line 159, in setup
    self.setup_optimizers(trainer)
    ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^
  File "/home/karunru/Home/Kaggle/kaggle_monorepo/projects/CMI_Detect_Behavior_with_Sensor_Data/.venv/lib/python3.13/site-packages/pytorch_lightning/strategies/strategy.py", line 139, in setup_optimizers
    self.optimizers, self.lr_scheduler_configs = _init_optimizers_and_lr_schedulers(self.lightning_module)
                                                 ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/karunru/Home/Kaggle/kaggle_monorepo/projects/CMI_Detect_Behavior_with_Sensor_Data/.venv/lib/python3.13/site-packages/pytorch_lightning/core/optimizer.py", line 180, in _init_optimizers_and_lr_schedulers
    optim_conf = call._call_lightning_module_hook(model.trainer, "configure_optimizers", pl_module=model)
  File "/home/karunru/Home/Kaggle/kaggle_monorepo/projects/CMI_Detect_Behavior_with_Sensor_Data/.venv/lib/python3.13/site-packages/pytorch_lightning/trainer/call.py", line 176, in _call_lightning_module_hook
    output = fn(*args, **kwargs)
  File "/home/karunru/Home/Kaggle/kaggle_monorepo/projects/CMI_Detect_Behavior_with_Sensor_Data/codes/exp/exp042/model.py", line 1417, in configure_optimizers
    optimizer = RAdamScheduleFree(
        params,
    ...<2 lines>...
        warmup_steps=self.schedule_free_config.warmup_steps,
    )
TypeError: RAdamScheduleFree.__init__() got an unexpected keyword argument 'warmup_steps'
08/23/2025 12:39:19 AM INFO __main__: Starting cross-validation training
08/23/2025 12:39:19 AM INFO __main__: Configuration: {'experiment': {'exp_num': 'exp042', 'name': 'exp042_configurable_schedule_free', 'description': 'ConvNeXt1D with configurable parameters and Schedule-Free optimizer', 'tags': ['imu_only', 'lstm', 'bigru', 'attention', 'residual_se_convnext', 'convnext', 'human_normalization', 'demographics', 'soft_f1_acls', 'bert', 'tsai', 'randaugment', 'imu_rotation', 'handedness_flip', 'orient_head', 'auxiliary_task', 'score_fusion', 'orientation_prior', 'configurable_model', 'schedule_free']}, 'paths': {'output_dir': '../../../outputs/exp042'}, 'data': {'root': '../../../data', 'train_path': '../../../data/train.csv', 'test_path': '../../../data/test.csv', 'demographics_train_path': '../../../data/train_demographics.csv', 'demographics_test_path': '../../../data/test_demographics.csv'}, 'demographics': {'enabled': True, 'embedding_dim': 16, 'categorical_embedding_dims': {'adult_child': 2, 'sex': 2, 'handedness': 2}, 'numerical_scaling_method': 'minmax', 'clip_outliers': True, 'age_min': 8.0, 'age_max': 60.0, 'height_min': 130.0, 'height_max': 195.0, 'shoulder_to_wrist_min': 35.0, 'shoulder_to_wrist_max': 75.0, 'elbow_to_wrist_min': 15.0, 'elbow_to_wrist_max': 50.0, 'categorical_features': ['adult_child', 'sex', 'handedness'], 'numerical_features': ['age', 'height_cm', 'shoulder_to_wrist_cm', 'elbow_to_wrist_cm'], 'hn_enabled': False, 'hn_eps': 0.001, 'hn_radius_min_max': (0.15, 0.9), 'hn_features': ['linear_acc_mag_per_h', 'linear_acc_mag_per_rS', 'linear_acc_mag_per_rE', 'acc_over_centripetal_rS', 'acc_over_centripetal_rE', 'alpha_like_rS', 'alpha_like_rE', 'v_over_h', 'v_over_rS', 'v_over_rE']}, 'model': {'name': 'cmi_squeezeformer_bert', 'input_dim': 20, 'd_model': 256, 'n_layers': 8, 'n_heads': 8, 'd_ff': 1024, 'num_classes': 18, 'kernel_size': 31, 'dropout': 0.1, 'imu_block1_out_channels': 64, 'imu_block1_kernel_size': 3, 'imu_block1_num_blocks': 2, 'imu_block1_drop_path': 0.1, 'imu_block2_out_channels': 128, 'imu_block2_kernel_size': 5, 'imu_block2_num_blocks': 2, 'imu_block2_drop_path': 0.15, 'bigru_hidden_size': 128, 'gru_dropout': 0.4, 'dense1_dropout': 0.5, 'dense2_dropout': 0.3}, 'training': {'seed': 42, 'batch_size': 128, 'num_workers': 8, 'epochs': 200, 'learning_rate': 0.0003, 'weight_decay': 1e-05, 'gradient_clip_val': 0.5, 'scheduler_type': 'cosine', 'scheduler_min_lr': 1e-06, 'scheduler_factor': 0.5, 'scheduler_patience': 5, 'use_mixed_precision': True, 'accumulate_grad_batches': 1}, 'loss': {'type': 'acls', 'alpha': 0.5, 'focal_gamma': 2.0, 'focal_alpha': 1.0, 'soft_f1_beta': 1.0, 'soft_f1_eps': 1e-06, 'label_smoothing': 0.1, 'nine_class_head_enabled': True, 'nine_class_loss_weight': 0.2, 'kl_weight': 0.1, 'kl_temperature': 1.0, 'auto_weighting': 'none', 'auto_weight_clamp': (-10.0, 10.0), 'uncertainty_init_value': 0.0, 'use_mixup': True, 'orient_loss_weight': 0.3}, 'acls': {'label_smoothing_alpha': 0.1, 'mbls_margin': 10.0, 'mbls_alpha': 0.1, 'mbls_schedule': None, 'acls_pos_lambda': 1.0, 'acls_neg_lambda': 0.1, 'acls_alpha': 0.1, 'acls_margin': 10.0}, 'length_grouping': {'enabled': False, 'use_dynamic_padding': False, 'mega_batch_multiplier': 8, 'percentile_max_length': 0.95, 'min_sequence_length': 50, 'max_sequence_length': 500, 'put_longest_first': True, 'fallback_to_fixed_length': True}, 'schedule_free': {'enabled': True, 'optimizer_type': 'RAdamScheduleFree', 'learning_rate_multiplier': 5.0, 'warmup_steps': 1000, 'batch_norm_calibration_steps': 50}, 'ema': {'enabled': True, 'beta': 0.9999, 'update_after_step': 1000, 'update_every': 10, 'update_model_with_ema_every': 1000, 'use_ema_for_validation': True}, 'val': {'name': 'stratified_group_kfold', 'params': {'n_splits': 5, 'random_state': 42, 'target': 'gesture', 'group': 'subject', 'id': 'sequence_id', 'force_recreate': False}}, 'preprocessing': {'target_sequence_length': 200}, 'augmentation': {'enable_randaugment': True, 'randaugment_n': 4, 'randaugment_m': 4.0, 'randaugment_prob': 0.9, 'add_noise_scale': 0.02, 'mag_scale_range': [0.9, 1.1], 'time_warp_max': 0.2, 'crop_ratio': 0.9, 'mask_ratio': 0.1, 'imu_rotation_angle_range': 0.2, 'handedness_flip_prob': 0.0, 'enable_handedness_flip': False, 'gaussian_noise_prob': 0.0, 'gaussian_noise_std': 0.01, 'time_scaling_prob': 0.0, 'time_scaling_range': [0.9, 1.1], 'partial_masking_prob': 0.0, 'partial_masking_length_range': [5, 20], 'partial_masking_ratio': 0.1}, 'logging': {'wandb_enabled': True, 'wandb_project': 'CMI-Detect-Behavior-with-Sensor-Data', 'wandb_name': 'exp042', 'wandb_tags': ['exp042', 'imu_only', 'lstm', 'bigru', 'attention', 'residual_se_convnext', 'convnext', 'human_normalization', 'demographics', 'soft_f1_acls', 'bert', 'tsai', 'randaugment', 'imu_rotation', 'handedness_flip', 'orient_head', 'auxiliary_task', 'score_fusion', 'orientation_prior', 'configurable_model', 'schedule_free']}, 'lightning': {'trainer': {'accelerator': 'auto', 'devices': 'auto', 'precision': '16-mixed', 'deterministic': False, 'benchmark': True, 'enable_checkpointing': True, 'log_every_n_steps': 10, 'check_val_every_n_epoch': 1, 'val_check_interval': 1.0}, 'callbacks': {'model_checkpoint': {'monitor': 'val_cmi_score', 'mode': 'max', 'save_top_k': 1, 'save_last': True, 'filename': 'epoch-{epoch:02d}-val_cmi_score-{val_cmi_score:.4f}', 'auto_insert_metric_name': False}, 'early_stopping': {'monitor': 'val_cmi_score', 'mode': 'max', 'patience': 30, 'min_delta': 0.0001, 'verbose': True}, 'lr_monitor': {'logging_interval': 'epoch'}, 'rich_progress_bar': {'enable': False}}}, 'root': '../../../outputs/exp042', 'target_gestures': ['Above ear - pull hair', 'Forehead - pull hairline', 'Forehead - scratch', 'Eyebrow - pull hair', 'Eyelash - pull hair', 'Neck - pinch skin', 'Neck - scratch', 'Cheek - pinch skin'], 'non_target_gestures': ['Drink from bottle/cup', 'Glasses on/off', 'Pull air toward your face', 'Pinch knee/leg skin', 'Scratch knee/leg skin', 'Write name on leg', 'Text on phone', 'Feel around in tray and pull out an object', 'Write name in air', 'Wave hello'], 'imu_features': ['acc_x', 'acc_y', 'acc_z', 'rot_w', 'rot_x', 'rot_y', 'rot_z', 'linear_acc_x', 'linear_acc_y', 'linear_acc_z', 'linear_acc_mag', 'linear_acc_mag_jerk', 'angular_vel_x', 'angular_vel_y', 'angular_vel_z', 'angular_distance']}
08/23/2025 12:39:19 AM INFO __main__: Starting training for fold 0
08/23/2025 12:41:00 AM INFO __main__: Using input_dim=20 (HN features: False)
08/23/2025 12:47:43 AM INFO __main__: Loading best model from: ../../../outputs/exp042/fold_0/version_3/checkpoints/epoch-105-val_cmi_score-0.7790.ckpt
08/23/2025 12:47:46 AM INFO __main__: Fold 0 results: {'fold': 0, 'val_loss': 1.1738331317901611, 'val_cmi_score': 0.7686240673065186, 'val_multiclass_loss': 1.4280866384506226, 'val_binary_loss': 0.14677190780639648, 'best_model_path': '../../../outputs/exp042/fold_0/version_3/checkpoints/epoch-105-val_cmi_score-0.7790.ckpt'}
08/23/2025 12:47:46 AM INFO __main__: Starting training for fold 1
08/23/2025 12:49:30 AM INFO __main__: Using input_dim=20 (HN features: False)
08/23/2025 12:55:27 AM INFO __main__: Loading best model from: ../../../outputs/exp042/fold_1/version_0/checkpoints/epoch-82-val_cmi_score-0.7558.ckpt
08/23/2025 12:55:31 AM INFO __main__: Fold 1 results: {'fold': 1, 'val_loss': 1.3083178997039795, 'val_cmi_score': 0.7567009329795837, 'val_multiclass_loss': 1.5849629640579224, 'val_binary_loss': 0.17146620154380798, 'best_model_path': '../../../outputs/exp042/fold_1/version_0/checkpoints/epoch-82-val_cmi_score-0.7558.ckpt'}
08/23/2025 12:55:31 AM INFO __main__: Starting training for fold 2
08/23/2025 12:57:20 AM INFO __main__: Using input_dim=20 (HN features: False)
08/23/2025 01:04:12 AM INFO __main__: Loading best model from: ../../../outputs/exp042/fold_2/version_0/checkpoints/epoch-108-val_cmi_score-0.7833.ckpt
08/23/2025 01:04:16 AM INFO __main__: Fold 2 results: {'fold': 2, 'val_loss': 1.2624043226242065, 'val_cmi_score': 0.7791608572006226, 'val_multiclass_loss': 1.517096996307373, 'val_binary_loss': 0.16721409559249878, 'best_model_path': '../../../outputs/exp042/fold_2/version_0/checkpoints/epoch-108-val_cmi_score-0.7833.ckpt'}
08/23/2025 01:04:16 AM INFO __main__: Starting training for fold 3
08/23/2025 01:05:59 AM INFO __main__: Using input_dim=20 (HN features: False)
08/23/2025 01:12:31 AM INFO __main__: Loading best model from: ../../../outputs/exp042/fold_3/version_0/checkpoints/epoch-97-val_cmi_score-0.7707.ckpt
08/23/2025 01:12:34 AM INFO __main__: Fold 3 results: {'fold': 3, 'val_loss': 1.2737873792648315, 'val_cmi_score': 0.7559146285057068, 'val_multiclass_loss': 1.5705115795135498, 'val_binary_loss': 0.13424694538116455, 'best_model_path': '../../../outputs/exp042/fold_3/version_0/checkpoints/epoch-97-val_cmi_score-0.7707.ckpt'}
08/23/2025 01:12:34 AM INFO __main__: Starting training for fold 4
08/23/2025 01:14:23 AM INFO __main__: Using input_dim=20 (HN features: False)
08/23/2025 01:21:40 AM INFO __main__: Loading best model from: ../../../outputs/exp042/fold_4/version_0/checkpoints/epoch-119-val_cmi_score-0.7774.ckpt
08/23/2025 01:21:43 AM INFO __main__: Fold 4 results: {'fold': 4, 'val_loss': 1.36347496509552, 'val_cmi_score': 0.7737503051757812, 'val_multiclass_loss': 1.6833055019378662, 'val_binary_loss': 0.16802158951759338, 'best_model_path': '../../../outputs/exp042/fold_4/version_0/checkpoints/epoch-119-val_cmi_score-0.7774.ckpt'}
08/23/2025 01:21:43 AM INFO __main__: Cross-validation completed
08/23/2025 01:21:43 AM INFO __main__: Mean CV Loss: 1.2764 ± 0.0622
08/23/2025 01:21:43 AM INFO __main__: Mean CV CMI Score: 0.7668 ± 0.0092
08/23/2025 01:21:43 AM INFO __main__: Results saved to: ../../../outputs/exp042/cv_results.csv
08/23/2025 01:21:43 AM INFO __main__: CV results logged to WandB
